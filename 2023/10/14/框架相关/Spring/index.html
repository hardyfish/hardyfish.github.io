<!DOCTYPE html>
<html lang="en" oncontextmenu="return false;">

<head oncontextmenu="return false;">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="baidu-site-verification" content="codeva-QodU0Nk5F7" />
	<meta name="google-site-verification" content="DbSTw8OJwtH5Qei7n8Jnew0YyQ5naPzdLAPiscu7zQE" />
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">

	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?7eeb54583579fabc0878be210d6ad60a";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>

	
	<!-- title -->
	
	<title>
	
		Spring | 
	 
	月伴飞鱼
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/%E5%A4%B4%E5%83%8F.jpg">
	
  
  	
<link rel="stylesheet" href="/css/main.css">

  	
<link rel="stylesheet" href="/css/reward.css">

	
<link rel="stylesheet" href="/css/jquery.fancybox.min.css">

	
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="/lib/highlight/darcula.css">

	
<link rel="stylesheet" href="/css/clipboard-use.css">


	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>


	
<script src="/lib/highlight/highlight.min.js"></script>


	
<script src="https://readmore.openwrite.cn/js/readmore-2.0.js"></script>

	
<script src="/lib/jquery-3.4.1.min.js"></script>

	
<script src="/lib/jquery.pjax.js"></script>


	
<script src="/js/main.js"></script>

	
<script src="/js/jquery.fancybox.min.js"></script>

	
		
<script src="/lib/valine/av-3.0.4-min.js"></script>

		
<script src="/lib/valine/Valine-1.3.10-min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
	
<script src="/js/clipboard.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>

<body oncontextmenu="return false;">
	<header id="header" oncontextmenu="return false;">
    <a id="title" href="/" class="logo">公众号月伴飞鱼</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">关于我</a>
		</li>

		<li class="menu-item">
			<a href="/个人微信.jpeg" class="menu-item-link">联系作者</a>
		</li>

	    <li class="menu-item">
			<a href="/site" class="menu-item-link">关于网站</a>
		</li>

		<li class="menu-item">
			<a href="/个人公众号.jpg" class="menu-item-link" target="_blank">我的公众号</a>
		</li>
		
		<li class="menu-item">
			<a href="https://tech.meituan.com/" class="menu-item-link" target="_blank">
				美团技术团队
			</a>
		</li>
		<li class="menu-item">
			<a href="https://tech.youzan.com/" class="menu-item-link" target="_blank">
				有赞技术团队
			</a>
		</li>
		<!--<li class="menu-item">
			<select class="menu-item-link menu-item-select">
				<option class="menu-item-link"  value="volvo">Volvo</option>
				<option class="menu-item-link"  value="saab">Saab</option>
				<option class="menu-item-link"  value="fiat">Fiat</option>
				<option class="menu-item-link"  value="audi">Audi</option>
			</select>
		</li>-->
	</ul>
</header>

	<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="按目录搜索一下">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										AI相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/01/14/AI%E7%9B%B8%E5%85%B3/AIGC/">
										AIGC
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										中间件
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/Dubbo/">
										Dubbo
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/12/19/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/">
										Elasticsearch
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/Netty/">
										Netty
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/25/%E4%B8%AD%E9%97%B4%E4%BB%B6/Solr/">
										Solr
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/19/%E4%B8%AD%E9%97%B4%E4%BB%B6/ZooKeeper/">
										ZooKeeper
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										产品相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/02/06/%E4%BA%A7%E5%93%81%E7%9B%B8%E5%85%B3/%E7%94%A8%E6%88%B7%E5%A2%9E%E9%95%BF/">
										用户增长
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										代码思想
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/12/15/%E4%BB%A3%E7%A0%81%E6%80%9D%E6%83%B3/CodeReview/">
										CodeReview
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/02/%E4%BB%A3%E7%A0%81%E6%80%9D%E6%83%B3/%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84/">
										代码重构
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										前端相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/CSS/">
										CSS
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/12/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">
										小程序
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										基础知识
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/11/27/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/JVM/">
										JVM
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%88%86%E5%B8%83%E5%BC%8F/">
										分布式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/12/10/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">
										并发编程
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
										设计模式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										大数据相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/01/25/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Doris/">
										Doris
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/20/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Flink/">
										Flink
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/07/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Hive/">
										Hive
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/20/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Spark/">
										Spark
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										学习专栏
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/31/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/%E4%BB%A3%E7%A0%81%E4%B9%8B%E4%B8%91/">
										代码之丑
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/26/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/%E5%A4%A7%E5%8E%82%E6%99%8B%E5%8D%87%E6%8C%87%E5%8D%97/">
										大厂晋升指南
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										学习书籍
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/02/05/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/HBase%E4%B8%8D%E7%9D%A1%E8%A7%89%E4%B9%A6/">
										HBase不睡觉书
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/02/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">
										Java并发编程实战
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/02/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/">
										Java并发编程的艺术
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/16/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/">
										Java开发手册
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/05/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/">
										代码整洁之道
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/07/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E4%B8%8EJava%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5/">
										大型网站系统与Java中间件开发实践
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/06/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA/">
										深入理解Java虚拟机
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/08/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E8%8B%B1%E8%AF%AD%E9%AD%94%E6%B3%95%E5%B8%88%E4%B9%8B%E8%AF%AD%E6%B3%95%E4%BF%B1%E4%B9%90%E9%83%A8/">
										英语魔法师之语法俱乐部
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										工具相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/11/09/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/Arthas/">
										Arthas
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/24/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/ChatGPT/">
										ChatGPT
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/21/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/GIT/">
										GIT
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/21/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/Hexo/">
										Hexo
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/21/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/MAC/">
										MAC
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/01/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/Maven/">
										Maven
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/09/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/PlantUML/">
										PlantUML
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/22/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/UTools/">
										UTools
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">
										实用工具
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										成长相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/31/%E6%88%90%E9%95%BF%E7%9B%B8%E5%85%B3/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">
										技术学习
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/07/%E6%88%90%E9%95%BF%E7%9B%B8%E5%85%B3/%E8%AF%BB%E4%B9%A6%E8%AE%A1%E5%88%92/">
										读书计划
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/09/%E6%88%90%E9%95%BF%E7%9B%B8%E5%85%B3/%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3/">
										面试相关
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										数据库
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/02/06/%E6%95%B0%E6%8D%AE%E5%BA%93/ClickHouse/">
										ClickHouse
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/27/%E6%95%B0%E6%8D%AE%E5%BA%93/HBase/">
										HBase
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/09/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/">
										MongoDB
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/12/02/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">
										MySQL
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/21/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/">
										Redis
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										服务器
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E6%9C%8D%E5%8A%A1%E5%99%A8/Docker/">
										Docker
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/09/%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/">
										Nginx
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/03/%E6%9C%8D%E5%8A%A1%E5%99%A8/Tomcat/">
										Tomcat
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/09/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86/">
										运维知识
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										架构相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/21/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/DDD/">
										DDD
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/02/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E6%9E%B6%E6%9E%84%E5%9B%BE/">
										架构图
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/02/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0/">
										架构学习
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/26/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E7%B3%BB%E7%BB%9F%E4%BF%9D%E9%9A%9C/">
										系统保障
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/31/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD/">
										系统性能
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/26/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">
										系统设计
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										框架相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/01/07/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Caffeine/">
										Caffeine
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/06/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Guava/">
										Guava
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/15/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/JWT/">
										JWT
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/08/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/MyBatis/">
										MyBatis
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/14/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/RPC%E6%A1%86%E6%9E%B6/">
										RPC框架
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/26/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Seata/">
										Seata
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/03/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/ShardingSphere/">
										ShardingSphere
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2023/10/14/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Spring/">
										Spring
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/03/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Thrift/">
										Thrift
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/29/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/XXLJOB/">
										XXLJOB
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/10/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">
										开源框架
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										消息队列
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/KAFKA/">
										KAFKA
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/20/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/">
										RabbitMQ
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/">
										RocketMQ
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										源码相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/12/13/%E6%BA%90%E7%A0%81%E7%9B%B8%E5%85%B3/RocketMQ/">
										RocketMQ
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										生活相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/27/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E4%B9%A6%E7%B1%8D/">
										书籍
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/17/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E5%81%9A%E8%8F%9C/">
										做菜
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/10/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E7%94%B5%E5%BD%B1/">
										电影
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/10/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E7%94%B5%E8%A7%86%E5%89%A7/">
										电视剧
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/11/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E7%BA%AA%E5%BD%95%E7%89%87/">
										纪录片
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/09/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E9%9F%B3%E4%B9%90/">
										音乐
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										算法相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/11/26/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/LeetCode/">
										LeetCode
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/11/26/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/%E5%89%91%E6%8C%87OFFER/">
										剑指OFFER
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/11/25/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/%E9%9D%A2%E8%AF%95%E7%AE%97%E6%B3%95/">
										面试算法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										编程语言
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/11/11/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Go%E5%9F%BA%E7%A1%80/">
										Go基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/11/21/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java%E5%9F%BA%E7%A1%80/">
										Java基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/29/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Python%E5%9F%BA%E7%A1%80/">
										Python基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										英语相关
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										老友记
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/08/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E8%80%81%E5%8F%8B%E8%AE%B0/%E7%AC%AC%E4%B8%80%E5%AD%A3/">
										第一季
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/08/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E8%80%81%E5%8F%8B%E8%AE%B0/%E7%AC%AC%E4%B8%89%E5%AD%A3/">
										第三季
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/23/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E8%80%81%E5%8F%8B%E8%AE%B0/%E7%AC%AC%E4%BA%94%E5%AD%A3/">
										第五季
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										雅思
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/01/25/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E9%9B%85%E6%80%9D/%E5%89%91%E6%A1%A5%E9%9B%85%E6%80%9D%E5%90%AC%E5%8A%9B%E7%9C%9F%E9%A2%9815/">
										剑桥雅思听力真题15
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/12/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E9%9B%85%E6%80%9D/%E5%89%91%E6%A1%A5%E9%9B%85%E6%80%9D%E5%90%AC%E5%8A%9B%E7%9C%9F%E9%A2%984/">
										剑桥雅思听力真题4
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/08/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E9%9B%85%E6%80%9D/%E9%9B%85%E6%80%9D%E9%98%85%E8%AF%BB538%E8%80%83%E7%82%B9%E8%AF%8D/">
										雅思阅读538考点词
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										计算机基础
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
										操作系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
										数据结构
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%AE%97%E6%B3%95%E7%9F%A5%E8%AF%86/">
										算法知识
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/12/19/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">
										网络基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title" oncontextmenu="return false;">

	Spring
</h1>
<div class="article-meta" oncontextmenu="return false;">
	<span>月伴飞鱼</span>
	<span>2023-10-14 15:19:40</span>
    
		<div id="article-categories">
            
                
                    <span>
                        <i class="fa fa-folder" aria-hidden="true"></i>
                        <a href="/categories/框架相关/">框架相关</a>
						
                    </span>
                
            
		</div>
    
</div>

<div id="container" class = "content999" oncontextmenu="return false;">
<!--打赏-->
        <div class="reward">
       <div class="reward-button">赏 <span class="reward-code">
        <span class="alipay-code"> <img class="alipay-img wdp-appear" src="/alipay.png"><b>支付宝打赏</b> </span> 
        <span class="wechat-code"> <img class="wechat-img wdp-appear" src="/weipay.jpeg"><b>微信打赏</b> </span> 
       </div>
      <p class="reward-notice">如果文章对你有帮助，欢迎点击上方按钮打赏作者！</p>
      </div>
      <!--打赏-->
	<div id="article-content">
		<p><strong>Bean作用域</strong></p>
<img src="/images/309.png" alt="image-20240114182133223" style="zoom:50%;" />
<blockquote>
<p>默认作用域是Singleton，多个线程访问同一个Bean时会存在线程不安全问题。</p>
<p><strong>保障线程安全方法：</strong></p>
<ul>
<li>在Bean对象中尽量避免定义可变的成员变量（不太现实）</li>
<li>在类中定义⼀个ThreadLocal成员变量，将需要的可变成员变量保存在 ThreadLocal 中。</li>
</ul>
</blockquote>
<p><strong>启动初始化</strong></p>
<p>@PostConstruct：</p>
<blockquote>
<p>在Bean创建期间由 Spring 调用的初始化方法。</p>
<ul>
<li>使用：将 @PostConstruct 注解添加到方法上就行。</li>
</ul>
</blockquote>
<p>InitializingBean：</p>
<blockquote>
<p>可以实现 InitializingBean 接口，让 Spring 调用某个初始化方法。</p>
</blockquote>
<p><strong>Controller和Service是线程安全的吗</strong></p>
<blockquote>
<p>默认情况下，Scope值是单例（Singleton）的，是线程不安全的。</p>
<p>尽量不要在<code>@Controller/@Service</code>等容器中定义静态变量，不论是单例(Singleton)还是多实例(Prototype)都是线程不安全的。</p>
</blockquote>
<p><strong>BeanFactoryPostProcessor 和 BeanPostProcessor</strong></p>
<blockquote>
<p>BeanFactoryPostProcessor：</p>
<ul>
<li>
<p>在 Bean 工厂实例化 Bean 之前对 Bean 的定义进行修改。</p>
</li>
<li>
<p>可以读取和修改 Bean 的定义元数据，例如修改 Bean 的属性值、添加额外的配置信息等。</p>
</li>
</ul>
<p>BeanPostProcessor：</p>
<ul>
<li>在 Bean 实例化后对 Bean 进行增强或修改。</li>
<li>它可以在 Bean 的初始化过程中对 Bean 进行后处理，例如对 Bean 进行代理、添加额外的功能等。</li>
</ul>
</blockquote>
<p><strong>Bean的生命周期</strong></p>
<p>Spring的生命周期大致分为：<code>创建</code> -&gt; <code>属性填充</code> -&gt; <code>初始化Bean</code> -&gt; <code>使用</code> -&gt; <code>销毁</code> 几个核心阶段。</p>
<blockquote>
<p>创建阶段:</p>
<ul>
<li>主要是创建对象，对象的创建权交由Spring管理。</li>
</ul>
<p>属性填充阶段:</p>
<ul>
<li>主要是进行依赖的注入，将当前对象依赖的bean对象，从Spring容器中找出来，然后填充到对应的属性中去。</li>
</ul>
<p>初始化bean阶段:</p>
<ul>
<li>包括回调各种Aware接口、回调各种初始化方法、生成AOP代理对象也在该阶段进行，该阶段主要是完成初始化回调。</li>
</ul>
<p>使用bean阶段:</p>
<ul>
<li>主要是bean创建完成，在程序运行期间，提供服务的阶段。</li>
</ul>
<p>销毁bean阶段:</p>
<ul>
<li>主要是容器关闭或停止服务，对bean进行销毁处理。</li>
</ul>
</blockquote>
<img src="/images/310.png" alt="image-20240114181239744" style="zoom:50%;" />
<p><strong>循环依赖</strong></p>
<p>循环依赖指的是<strong>一个实例或多个实例存在相互依赖的关系</strong>（类之间循环嵌套引用）。</p>
<pre><code class="language-java">public class AService &#123;
    private BService bService;
&#125;

public class BService &#123;
    private AService aService;
&#125;
</code></pre>
<p>Bean的创建步骤：</p>
<blockquote>
<p>在创建 Bean 之前，Spring 会通过扫描获取 BeanDefinition。</p>
<p>BeanDefinition就绪后会读取 BeanDefinition 中所对应的 class 来加载类。</p>
<p>实例化阶段：根据构造函数来完成实例化 （<strong>未属性注入以及初始化的对象</strong>（原始对象））。</p>
<p>属性注入阶段：对 Bean 的属性进行依赖注入。</p>
<p>如果 Bean 的某个方法有AOP操作，则需要根据原始对象生成<strong>代理对象</strong>。</p>
<ul>
<li>AOP代理是<code>BeanPostProcessor</code>实现的，而<code>BeanPostProcessor</code>是发生在属性注入阶段后的。</li>
</ul>
<p>最后把代理对象放入单例池（一级缓存<code>singletonObjects</code>）中。</p>
</blockquote>
<p>为什么 Spring Bean 会产生循环依赖问题？</p>
<blockquote>
<p>当 <code>AService</code> 创建时，会先对 <code>AService</code> 实例化生成一个原始对象，然后在进行属性注入时发现了需要 <code>BService</code> 对应的 Bean，此时就会去为 <code>BService</code> 进行创建，在 <code>BService</code> 实例化后生成一个原始对象后进行属性注入，此时会发现也需要 <code>AService</code> 对应的 Bean。</p>
</blockquote>
<p><img src="/images/311.png" alt="image-20231014162629222"></p>
<p>三大循环依赖问题场景:</p>
<blockquote>
<p>单例作用域下的Setter方法注入/Field属性注入出现的循环依赖。</p>
<ul>
<li>在 Spring 中是不会产生循环依赖问题的，这主要是靠 <strong>三级缓存</strong> 机制解决。</li>
</ul>
<p>单例作用域下的构造器注入出现的循环依赖。</p>
<ul>
<li>因为 <strong>构造器注入</strong> 发生在 <strong>实例化阶段</strong>，而 Spring 解决循环依赖问题依靠的 <strong>三级缓存</strong> 在 <strong>属性注入阶段</strong>，也就是说调用构造函数时还未能放入三级缓存中，所以无法解决 <strong>构造器注入</strong> 的循环依赖问题。</li>
</ul>
<p>原型作用域下的属性注入出现的循环依赖问题。</p>
<ul>
<li>因为 Spring 不会缓存 <strong>原型</strong> 作用域的 Bean，所以 Spring 无法解决 <strong>原型</strong> 作用域的 Bean。</li>
</ul>
</blockquote>
<p>三级缓存：</p>
<pre><code class="language-java">/** Cache of singleton objects: bean name to bean instance. */
private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);

/** Cache of singleton factories: bean name to ObjectFactory. */
private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16);

/** Cache of early singleton objects: bean name to bean instance. */
private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16);
</code></pre>
<blockquote>
<p>一级缓存（<code>singletonObjects</code>）：缓存的是<strong>已经实例化、属性注入、初始化后</strong>的 Bean 对象。</p>
<p>二级缓存（<code>earlySingletonObjects</code>）：缓存的是<strong>实例化后，但未属性注入、初始化</strong>的 Bean对象（用于提前暴露 Bean）。</p>
<p>三级缓存（<code>singletonFactories</code>）：缓存的是一个 <code>ObjectFactory</code>，主要作用是生成原始对象进行 AOP 操作后的<strong>代理对象</strong>（这一级缓存主要用于解决 AOP 问题）。</p>
</blockquote>
<p>为什么缓存可以解决循环依赖问题？</p>
<blockquote>
<p>在创建 <code>AService</code> 时，实例化后将 <strong>原始对象</strong> 存放到缓存中（提早暴露），然后依赖注入时发现需要 <code>BService</code>，便会去创建 <code>BService</code>，实例化后同样将 <strong>原始对象</strong> 存放到缓存中，然后依赖注入时发现需要 <code>AService</code> 便会从缓存中取出并注入，这样 <code>BService</code> 就完成了创建，随后 <code>AService</code> 也就能完成属性注入，最后也完成创建。</p>
</blockquote>
<p><img src="/images/312.png" alt="image-20231014163323751"></p>
<p>为什么还需要第三级缓存？</p>
<blockquote>
<p><strong>第三级缓存（<code>singletonFactories</code>）</strong> 是为了处理 Spring 的 AOP的。</p>
<p>如果 <code>AService</code> 中方法没有使用 AOP 操作，会发现 <code>BService</code> 注入的 <strong>原始对象</strong> 与最后 <code>AService</code> 完成创建后的最终对象是<strong>同一个对象</strong>。</p>
<p>如果 <code>AService</code> 方法中有 AOP 操作时，当 <code>AService</code> 的原始对象赋值（注入）给 <code>BService</code>，<code>AService</code> 会进行 AOP 操作产生一个 <strong>代理对象</strong>，这个代理对象最后会被放入单例池（一级缓存）中，也就是说此时 <code>BService</code> 中注入的对象是原始对象，而 <code>AService</code> 最终创建的完成后是代理对象，这样就会<strong>导致 <code>BService</code> 依赖的 <code>AService</code> 和 最终的 <code>AService</code> 不是同一个对象</strong>。</p>
<p>出现这个问题原因：AOP 是通过 <code>BeanPostProcessor</code> 实现的，而 <code>BeanPostProcessor</code> 是在 <strong>属性注入阶段后</strong> 才执行的，所以会导致<strong>注入的对象有可能和最终的对象不一致</strong>。</p>
</blockquote>
<p><img src="/images/313.png" alt="image-20231014163541994"></p>
<p>Spring 是如何通过第三级缓存来避免 AOP 问题的？</p>
<blockquote>
<p>三级缓存通过利用 <code>ObjectFactory</code> 和 <code>getEarlyBeanReference()</code> 做到了提前执行 AOP 操作从而生成代理对象。</p>
<p>在上移到二级缓存时，可以做到如果 Bean 中有 AOP 操作，那么提前暴露的对象会是 AOP 操作后返回的代理对象；如果没有 AOP 操作，那么提前暴露的对象会是原始对象。</p>
<ul>
<li>只有等完成了属性注入、初始化后的 Bean 才会上移到一级缓存（单例池）中。</li>
</ul>
<p>这样就能做到出现循环依赖问题时，注入依赖的对象和最终生成的对象是同一个对象。</p>
<ul>
<li>相当于 AOP 提前在属性注入前完成，这样就不会导致后面生成的代理对象与属性注入时的对象的不一致。</li>
</ul>
</blockquote>
<p><strong>设计模式</strong></p>
<blockquote>
<p><strong>单例设计模式 :</strong></p>
<ul>
<li>Spring 中的 Bean 默认都是单例的。</li>
</ul>
<p><strong>⼯⼚设计模式 :</strong></p>
<ul>
<li>通过 BeanFactory、 ApplicationContext 创建 Bean 对象。</li>
</ul>
<p><strong>代理设计模式 :</strong></p>
<ul>
<li>Spring AOP 功能的实现。</li>
</ul>
<p><strong>观察者模式：</strong></p>
<ul>
<li>Spring 事件驱动模型。</li>
</ul>
<p><strong>适配器模式：</strong></p>
<ul>
<li>Spring AOP 的增强或通知(Advice)使⽤到了适配器模式、Spring MVC 中也是⽤到了适配器模式适配 Controller。</li>
</ul>
</blockquote>
<h1>基本概念</h1>
<p><strong>IOC（控制反转）</strong></p>
<p>Spring中有一个容器，我们将Bean放到这个容器中，让这个容器为我们创建实例，当需要时我们直接从这个容器中进行获取即可。</p>
<blockquote>
<p>使用IOC最大的好处就是减少了代码的耦合度，降低了程序的维护成本。</p>
</blockquote>
<img src="/images/314.png" alt="img" style="zoom:60%;" />
<p>实现原理:</p>
<blockquote>
<p>Spring实现IOC容器的是通过：工厂 + 反射，实现的。</p>
<p>如果是基于全注解形式的话，只是将读取配置文件的步骤改成了读取配置类，然后通过配置类获取需要创建实现的Bean，并通过反射将其创建。</p>
</blockquote>
<img src="/images/315.png" alt="img" style="zoom:100%;" />
<p><strong>DI依赖注入</strong></p>
<blockquote>
<p>站在容器的角度，将对象创建依赖的其他对象注入到对象中。</p>
</blockquote>
<p><strong>AOP</strong></p>
<blockquote>
<p>AOP 面向切面的编程：在不改变源代码的情况下，实现对逻辑功能的修改。</p>
<ul>
<li>常用的场景包括记录日志、异常处理、性能监控、安全控制（例如拦截器）等。</li>
</ul>
</blockquote>
<p>AOP 原理：</p>
<blockquote>
<p>动态的生成代理类，代理类的执行过程为：执行增加的代码（例如方法日志记录）-&gt; 回调原方法 -&gt; 增加的代码逻辑。</p>
<p>Spring AOP 动态代理采用 JDK 动态代理或 CGlib 动态生成代理类，判断被切面的类是否有其实现的接口，如果有对应的接口，则采用 JDK 动态代理，否则采用 CGlib 字节码生成机制动态代理方式。</p>
</blockquote>
<h1>SpringMVC</h1>
<blockquote>
<p>SpringMVC是一个基于Servlet容器的Web应用框架。</p>
<ul>
<li>Servlet容器通常指Tomcat等服务容器。</li>
</ul>
<p>Servlet容器会负责监听端口消息并映射为Request/Response对象，然后交给Servlet实例去处理。</p>
<p>SpringMVC框架的作用核心就是Servlet实例。</p>
<ul>
<li>这个实例在Spring中默认是DispatcherServlet。</li>
</ul>
</blockquote>
<p><img src="/images/316.png" alt="Spring MVC结构图"></p>
<blockquote>
<p>客户端（浏览器）发送请求，直接请求到 DispatcherServlet。</p>
<p>DispatcherServlet 根据请求信息调⽤ HandlerMapping，解析请求对应的 Handler。</p>
<p>解析到对应的 Handler （也就是 Controller 控制器）后，开始由HandlerAdapter 适配器处理。</p>
<p>HandlerAdapter 会根据 Handler 来调⽤真正的处理器开处理请求，并处理相应的业务逻辑。</p>
<p>处理器处理完业务后，会返回⼀个 ModelAndView 对象， Model 是返回的数据对象。</p>
<p>ViewResolver 会根据逻辑 View 查找实际的 View。</p>
<p>DispaterServlet 把返回的 Model 传给 View（视图渲染）。</p>
<p>把 View 返回给请求者（浏览器）。</p>
</blockquote>
<p><strong>核心组件DispatcherServlet</strong></p>
<blockquote>
<p>在Spring容器启动阶段读取映射规则，如RequestMapping。</p>
<p>在请求到来的时候，按照加载的请求映射规则找到合适的处理方法。</p>
<p>当处理请求的过程中出现了异常，对异常进行处理，如返回合适的界面或状态码。</p>
<p>解析返回View的主题、时区等信息。</p>
<p>渲染返回的视图。</p>
</blockquote>
<p><img src="/images/317.png" alt="DispatcherServlet功能图"></p>
<p><strong>请求映射HandlerMapping</strong></p>
<blockquote>
<p>请求映射用于根据请求找到该请求需要调用的所有方法，包含过滤器和处理方法等。</p>
<p>比较常用的一种请求映射是RequestMappingHandlerMapping。</p>
<ul>
<li>从名称上可以看出来这个HandlerMapping是用于处理<code>@RequestMapping</code>注解请求映射的类。</li>
</ul>
<p>该类的主要作用是在收到请求之后，按顺序拿到所有需要调用的方法（主要包含拦截器和处理方法），然后一一调用这些方法。</p>
</blockquote>
<p><img src="/images/318.png" alt="Handler Mapping原理"></p>
<p><strong>拦截器HandlerInterceptor</strong></p>
<blockquote>
<p>Spring的拦截器可以灵活的在请求处理前、请求处理后和请求完成三个阶段自定义操作，比如用户权限校验等。</p>
</blockquote>
<p><img src="/images/319.png" alt="Hadler Interceptor"></p>
<p><strong>处理方法Handler</strong></p>
<blockquote>
<p>处理方法在DispatcherServlet定义为Object类型，如果使用了<code>@RequestMapping</code>来根据请求查找处理方法，那么查找到的处理方法就是<code>HandlerMethod</code>类型，对应于Controller中添加了对应RequestMapping的方法。</p>
</blockquote>
<p><strong>处理方法适配器HandlerAdapter</strong></p>
<blockquote>
<p>DispatcherServlet从HandlerMapping中获取到的处理方法是Object类型，意味着不同的处理方法可能返回不同的对象。</p>
<p>DispatcherServlet本身是一个调度器，不应该关注如何调用不同的处理方法。</p>
<ul>
<li>所以Spring提供了HandlerAdapter列表用户处理不同的调度方法。</li>
</ul>
</blockquote>
<p><img src="/images/320.png" alt="Hadler"></p>
<p><strong>异常处理HandlerExceptionResolver</strong></p>
<blockquote>
<p>HandlerExceptionResolver用于处理请求过程中出现的异常。</p>
<ul>
<li>日常开发中使用比较多的是ExceptionHandlerExceptionResolver，也就是<code>@ExceptionHandler</code>注解。</li>
</ul>
<p><code>@ExceptionHander</code>可以放在<code>@ControllerAdvice</code>注解的类中，表示对所有的Controller都会生效。</p>
</blockquote>
<h1>事务</h1>
<p><strong>嵌套事务</strong></p>
<blockquote>
<p>举例，methodA 中调用了 methodB，两个方法都有对数据库的操作，而且都需要事务。</p>
<p>这种多个方法调用链中都有事务的场景，就是嵌套事务。</p>
<p>要注意的是，并不是说多个方法使用一个事务才叫嵌套，哪怕是不同的事务，只要在这个方法的调用链中，都是嵌套事务。</p>
</blockquote>
<pre><code class="language-java">// MethodA:
public void methodA()&#123;
    int updated = connection.prepareStatement().executeUpdate();
    methodB();
    // ...
&#125;

// MethodB:
public void methodB()&#123;
    // ...
&#125;
</code></pre>
<p><strong>事务传播行为</strong></p>
<blockquote>
<p>方法调用链中的子方法，是用一个新事务，还是使用当前事务呢？</p>
<ul>
<li>这个子方法决定使用新事务还是当前事务（或不使用事务）的策略，就叫事务传播。</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>Spring传播行为</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>REQUIRED</td>
<td>支持当前事务，如果不存在，就新建一个</td>
</tr>
<tr>
<td>SUPPORTS</td>
<td>支持当前事务，如果不存在，就不使用事务</td>
</tr>
<tr>
<td>MANDATORY</td>
<td>支持当前事务，如果不存在，抛出异常</td>
</tr>
<tr>
<td>REQUIRES_NEW</td>
<td>如果有事务存在，挂起当前事务，创建一个新的事务</td>
</tr>
<tr>
<td>NOT_SUPPORTED</td>
<td>以非事务方式运行，如果有事务存在，挂起当前事务</td>
</tr>
<tr>
<td>NEVER</td>
<td>以非事务方式运行，如果有事务存在，抛出异常</td>
</tr>
<tr>
<td>NESTED</td>
<td>如果当前事务存在，则嵌套事务执行（嵌套式事务）</td>
</tr>
</tbody>
</table>
<p><strong>事务失效</strong></p>
<p>1、事务方法被Final、Static关键字修饰:</p>
<blockquote>
<p>如果一个方法被声明为<code>final</code>或者<code>static</code>，则该方法不能被子类重写，也就是说无法在该方法上进行动态代理，这会导致<code>Spring</code>无法生成事务代理对象来管理事务。</p>
</blockquote>
<pre><code class="language-java">@Service
public class ServiceImpl  &#123;

    @Autowired
    private TestMapper1 mapper1;
    
    @Autowired
    private TestMapper2 mapper2;

    @Transactional
    public final void add(Test test) &#123;
        mapper1.save();
        mapper2.save();
    &#125;
&#125;
</code></pre>
<p>2、同一个类中，方法内部调用:</p>
<blockquote>
<p>事务是通过<code>Spring AOP</code>代理来实现的，而在同一个类中，一个方法调用另一个方法时，<strong>调用方法直接调用目标方法的代码，而不是通过代理类进行调用</strong>。</p>
<ul>
<li>即调用目标<code>add</code>方法不是通过代理类进行的，因此事务不生效。</li>
</ul>
<p><strong>解决方案</strong>：可以新建多一个类，让这两个方法分开，分别在不同的类中。</p>
</blockquote>
<pre><code class="language-java">@Service
public class ServiceImpl implements Service &#123;

    @Autowired
    private TestMapper1 mapper1;
    
    @Autowired
    private TestMapper2 mapper2;
    
    public void add(Test test)&#123;
     // 调用内部的事务方法
     this.add(test);
   &#125;

    @Transactional
    public void add(Test test) &#123;
        mapper1.save();
        mapper2.save();
    &#125;
&#125;
</code></pre>
<p>3、方法的访问权限不是Public:</p>
<blockquote>
<p>代理的事务方法不是<code>public</code>的话，<code>spring</code>的<code>computeTransactionAttribute()</code>就会返回null，这时事务属性不存在了。</p>
</blockquote>
<p>4、RollbackFor属性配置错误:</p>
<blockquote>
<p><code>rollbackFor</code>属性指定的异常必须是<code>Throwable</code>或者其子类。</p>
<ul>
<li>默认情况下，<code>RuntimeException</code>和<code>Error</code>两种异常都是会自动回滚的。</li>
</ul>
<p>代码例子：指定了<code>rollbackFor = Error.class</code>，但是抛出的异常又是<code>Exception</code>，因此事务就不生效。</p>
</blockquote>
<pre><code class="language-java">    @Transactional(rollbackFor = Error.class)
    public void add(Test test) &#123;
        mapper1.save(test);
        mapper2.save(test);
        //模拟异常抛出
        throw new Exception();
    &#125;
</code></pre>
<p>5、事务注解被覆盖导致事务失效：</p>
<blockquote>
<p><code>MyTestService</code>是<code>MyService</code>的子类，并且覆盖了<code>doSomething()</code>方法。</p>
<ul>
<li>在该方法中，使用了不同的传播行为<code>（REQUIRES_NEW）</code>来覆盖父类的<code>@Transactional</code>注解。</li>
</ul>
<p>在这种情况下，当调用<code>MyTestService</code>的<code>doSomething()</code>方法时，由于子类方法中的注解覆盖了父类的注解，<code>Spring</code>框架<strong>将不会在父类的方法中启动事务</strong>。</p>
<p>因此，当<code>MyRepository</code>的<code>save()</code>方法被调用时，事务将不会被启动，也不会回滚。</p>
<p>这将导致数据不一致的问题，因为在<code>MyRepository</code>的<code>save()</code>方法中进行的数据库操作将不会回滚。</p>
</blockquote>
<pre><code class="language-java">public interface MyRepository &#123;
    @Transactional
    void save(String data);
&#125;

public class MyRepositoryImpl implements MyRepository &#123;
    @Override
    public void save(String data) &#123;
        // 数据库操作
    &#125;
&#125;

public class MyService &#123;

    @Autowired
    private MyRepository myRepository;

    @Transactional
    public void doSomething(String data) &#123;
        myRepository.save(data);
    &#125;
&#125;

public class MyTestService extends MyService &#123;
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void doSomething(String data) &#123;
        super.doSomething(data);
    &#125;
&#125;
</code></pre>
<p>6、嵌套事务：</p>
<blockquote>
<p>如果<code>saveFlow</code>出现运行时异常，会继续往上抛，到外层<code>add</code>的方法，导致<code>mapper.save</code>也会回滚啦。</p>
<p><strong>如果不想因为被内部嵌套的事务影响</strong>，可以用<code>try-catch</code>包住。</p>
</blockquote>
<pre><code class="language-java">@Service
public class ServiceInOutService &#123;

    @Autowired
    private FlowService flowService;
    @Autowired
    private Mapper mapper;

    @Transactional
    public void add(Test test) throws Exception &#123;
        mapper.save(test);
        flowService.saveFlow(test);
    &#125;
&#125;

@Service
public class FlowService &#123;

    @Autowired
    private Mapper mapper;

    @Transactional(propagation = Propagation.NESTED)
    public void saveFlow(Test test) &#123;
        mapper.save(test);
        throw new RuntimeException();
    &#125;
&#125;
</code></pre>
<pre><code class="language-java">@Transactional
public void add(Test test) throws Exception &#123;
  mapper.save(test);
  try &#123;
    flowService.saveFlow(test);
  &#125; catch (Exception e) &#123;
    log.error(&quot;save flow fail,message:&#123;&#125;&quot;,e.getMessage());
  &#125;
&#125;
</code></pre>
<p>7、事务多线程调用：</p>
<blockquote>
<p><code>Spring</code>事务是基于线程绑定的，<strong>每个线程都有自己的事务上下文</strong>，而多线程环境下可能会存在多个线程共享同一个事务上下文的情况，导致事务失效。</p>
<p><code>Spring</code>事务管理器通过使用线程本地变量（<code>ThreadLocal</code>）来实现线程安全。</p>
</blockquote>
<pre><code class="language-java">@Service
public class Service &#123;

    @Autowired
    private Mapper1 mapper1;

    @Mapper1
    private FlowService flowService;

    @Transactional
    public void add(Test test) &#123;
        mapper1.save(test);
        //多线程调用
        new Thread(() -&gt; &#123;
            flowService.save(test);
        &#125;).start();
    &#125;
&#125;

@Service
public class FlowService &#123;

    @Autowired
    private Mapper1 mapper1;

    @Transactional
    public void save(Test test) &#123;
        mapper1.saveFlow(test);
    &#125;
&#125;
</code></pre>
<p>8、异常被捕获并处理了，没有重新抛出：</p>
<blockquote>
<p>事务中的异常已经被业务代码捕获并处理，而没有被正确地传播回事务管理器，事务将无法回滚。</p>
<p>在<code>spring</code>事务方法中，当我们使用了<code>try-catch</code>，catch住异常，一定要重新把异常抛出来。</p>
</blockquote>
<pre><code class="language-java">@Service
public class ServiceImpl implements Service &#123;

    @Autowired
    private Mapper1 mapper1;

    @Autowired
    private Mapper2 mapper2;

    @Transactional
    public void add(Test test) &#123;
        try &#123;
            mapper1.save();
            mapper2.save();
        &#125; catch (Exception e) &#123;
            log.error(&quot;add error,id:&#123;&#125;,message:&#123;&#125;&quot;, tianluo.getId(),e.getMessage());
            //throw e;
        &#125;
    &#125;

&#125;
</code></pre>
<p>9、手动抛了别的异常：</p>
<blockquote>
<p>如果手动抛了<code>Exception</code>异常，但是是不会回滚的，因为Spring默认只处理<code>RuntimeException和Error</code>，对于普通的<code>Exception</code>不会回滚，除非，用<code>rollbackFor</code>属性指定配置。</p>
</blockquote>
<h1>SpringBoot</h1>
<p><strong>Spring Boot Starter</strong></p>
<blockquote>
<p>实现一个Starter：</p>
<ul>
<li>Starter 命名。</li>
<li>自动配置类，用来初始化相关的 bean。</li>
<li>指明自动配置类的配置文件 <code>spring.factories</code>。</li>
<li>自定义属性实体类，声明 starter 的应用配置属性。</li>
</ul>
</blockquote>
<p>名字:</p>
<blockquote>
<p>官方的 starter 的命名格式为 <code>spring-boot-starter-&#123;name&#125;</code>。</p>
<p>非官方的 starter 的命名格式为 <code>&#123;name&#125;-spring-boot-starter</code>，把自定义的 starter 命名为 <code>fish-spring-boot-starter</code>，命名在 pom 文件里。</p>
</blockquote>
<pre><code class="language-xml">&lt;groupId&gt;fish.springcloud&lt;/groupId&gt;
&lt;artifactId&gt;fish-spring-boot-starter&lt;/artifactId&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;
&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
</code></pre>
<p>引入自动配置包及其它相关依赖包:</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>创建 <code>spring.factories</code> 文件:</p>
<blockquote>
<p>在 <code>resource/META-INF</code> 目录下创建名称为 <code>spring.factories</code> 的文件。</p>
<p>当 Spring Boot 启动的时候，会在 classpath 下寻找所有名称为 <code>spring.factories</code> 的文件，然后运行里面的配置指定的自动加载类，将指定类(一个或多个)中的相关 bean 初始化。</p>
</blockquote>
<pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  kite.springcloud.boot.starter.example.FishAutoConfigure
</code></pre>
<p>编写自动配置类:</p>
<blockquote>
<p>自动配置类是用来初始化 starter 中的相关 bean 的。</p>
</blockquote>
<pre><code class="language-java">@Configuration
@ConditionalOnClass(FishService.class)
@EnableConfigurationProperties(FishProperties.class)
@Slf4j
public class FishAutoConfigure &#123;

    @Autowired
    private FishProperties fishProperties;

    @Bean
    @ConditionalOnMissingBean(FishService.class)
    @ConditionalOnProperty(prefix = &quot;fish.example&quot;,value = &quot;enabled&quot;, havingValue = &quot;true&quot;)
    FishService fishService()&#123;
        return new FishService(fishProperties);
    &#125;
&#125;
</code></pre>
<p>实现属性配置类:</p>
<pre><code class="language-java">@Data
@ConfigurationProperties(&quot;fish.example&quot;)
public class FishProperties &#123;

    private String host;

    private int port;
&#125;
</code></pre>
<p>实现相关功能类：</p>
<pre><code class="language-java">@Slf4j
public class FishService &#123;

    private String host;

    private int port;

    public FishService(FishProperties fishProperties)&#123;
        this.host = fishProperties.getHost();
        this.port = fishProperties.getPort();
    &#125;

    public void print()&#123;
        log.info(this.host + &quot;:&quot; +this.port);
    &#125;
&#125;
</code></pre>
<p>打包:</p>
<blockquote>
<p>通过 maven <code>mvn install</code>命令将 starter 安装到本地 maven 仓库。</p>
<p>也可以通过 <code>mvn package deploy</code> 发布到私服。或者发布到中央仓库。</p>
</blockquote>
<p><strong>自动配置原理</strong></p>
<blockquote>
<p>Spring启用全自动配置功能的注解就是<code>@EnableAutoConfiguration</code>，应用添加了<code>@EnableAutoConfiguration</code>注解之后，会读取所有jar包下面的<code>spring.factories</code>文件，获取文件中配置的自动装配模块，然后去装配对应的模块。</p>
<p><code>@EnableAutoConfiguration</code>的功能可总结为：</p>
<ul>
<li>使Spring启用factories机制导入各个starter模块的配置。</li>
</ul>
</blockquote>
<p><strong>启动流程</strong></p>
<blockquote>
<p><code>构造SpringBootApplication对象</code>和执行<code>run方法</code>。</p>
<p>核心注解<code>@SpringBootConfiguration</code>标识启动类为配置类。</p>
<p><code>@EnableAutoConfiguration</code>通过内部<code>@Import</code>注解<code>AutoConfigurationImportSelector.class</code>实现自动装配。</p>
<p><code>@ComponentScan</code>默认扫描当前目录及子目录下的Bean。</p>
<p>SpringBootApplication的构造方法主要做了几件事:</p>
<ul>
<li>根据是否加载servlet类判断是否是web环境。</li>
<li>获取所有初始化器，扫描所有<code>META-INF/spring.factories</code>下的<code>ApplicationContextInitializer</code>子类通过反射拿到实例，在spring实例启动前后做一些回调工作。</li>
<li>获取所有监听器，同2，也是扫描配置加载对应的类实例。</li>
</ul>
<p>run方法主要创建了配置环境、事件监听、启动应用上下文，其中refresh方法贯穿<code>springbean</code>的生命周期。</p>
<p>执行bean的生命周期的前后置钩子方法，并且处理spring的注解标注的类。</p>
<p>在<code>onRefresh</code>中通过Java代码构建出tomcat容器并启动。</p>
</blockquote>
<p><img src="/images/321.png" alt="img"></p>
<h1>SpringCloud</h1>
<h2 id="Eureka">Eureka</h2>
<blockquote>
<p>Spring Cloud Eureka 是 Netflix 公司开发的注册发现组件，本身是一个基于 REST 的服务。</p>
<ul>
<li>提供注册与发现，同时还提供了负载均衡、故障转移等能力。</li>
</ul>
<p>Eureka 有 3 个角色:</p>
<ul>
<li>服务中心（Eureka Server）：
<ul>
<li>服务器端，它提供服务的注册和发现功能，即实现服务的治理。</li>
</ul>
</li>
<li>服务提供者（Service Provider）：
<ul>
<li>服务提供者，它将自身服务注册到 服务中心，以便 服务消费者 能够通过服务器提供的服务清单（服务注册列表）来调用它。</li>
</ul>
</li>
<li>服务消费者（Service Consumer）：
<ul>
<li>服务消费者，它从 服务中心 获取已注册的服务列表，从而消费服务。</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<p>Eureka 是 AP 架构（可用性和分区容错性），Zookeeper 是 CP 架构（一致性和分区容错性）。</p>
<ul>
<li>
<p>Eueka 优先保证服务的可用性。</p>
</li>
<li>
<p>Zookeeper 在 Master 节点因网络故障与其他节点失去联系时，剩余节点选取 Leader 时间太长，导致选举期间注册服务瘫痪。</p>
</li>
</ul>
</blockquote>
<p>服务自保机制（Service Self-Preservation Mechanism）：</p>
<blockquote>
<p>用于保护在 Eureka 注册中心上注册的微服务实例免受意外删除的影响。</p>
<p>当微服务实例在心跳超时时间内没有发送心跳信号给 Eureka Server 时:</p>
<ul>
<li>Eureka Server 不会立即将其从服务注册表中删除，而是认为该实例可能处于网络故障等临时异常情况。</li>
<li>会将其保留在注册表中，提供一定的自我保护，防止误删健康的实例。</li>
</ul>
<p>这样可以避免因网络抖动、服务器负载或其他临时问题导致服务实例被误删，从而提高服务的稳定性和可用性。</p>
</blockquote>
<p>服务剔除机制（Service Eviction Mechanism）：</p>
<blockquote>
<p>是指当服务实例连续长时间未发送心跳信号、或注册中心发现某个服务实例心跳连续失败的次数超过一定阈值时：</p>
<ul>
<li>Eureka Server 会将该服务实例从服务注册表中剔除。</li>
</ul>
<p>通过服务剔除机制，可以排除不健康、异常或故障状态的服务实例：</p>
<ul>
<li>防止其他服务继续调用故障的实例减少错误的传播范围，提高系统的稳定性。</li>
</ul>
</blockquote>
<p><strong>基本原理</strong></p>
<p>Eureka 注册中心的 Server 端有三级缓存来保存注册信息，可以利用缓存的快速读取来提高系统性能。</p>
<blockquote>
<p>一级缓存：只读缓存 <code>readOnlyCacheMap</code>，数据结构 ConcurrentHashMap。</p>
<p>二级缓存：读写缓存 <code>readOnlyCacheMap</code>，Guava Cache。</p>
<p>三级缓存：本地注册表 <code>registry</code>，数据结构 ConcurentHashMap。</p>
</blockquote>
<blockquote>
<p>默认情况下，每隔 30 秒从读写缓存将注册信息更新到只读缓存。</p>
<p>默认情况下，客户端读取注册表时，先从只读缓存读，如果没有，则从读写缓存中读取，如果还是没有，则从本地注册表 registry 读取。</p>
<p>默认情况下，每隔 180 秒定时过期读写缓存。</p>
<p>服务实例注册、下线、故障时，会实时过期读写缓存。</p>
</blockquote>

	</div>
</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2023/10/19/%E4%B8%AD%E9%97%B4%E4%BB%B6/ZooKeeper/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  ZooKeeper
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2023/10/12/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E9%9B%85%E6%80%9D/%E5%89%91%E6%A1%A5%E9%9B%85%E6%80%9D%E5%90%AC%E5%8A%9B%E7%9C%9F%E9%A2%984/">
                雅思
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>




<script>

    //document.oncontextmenu=new Function("event.returnValue=false");
	//document.onselectstart=new Function("event.returnValue=false");

	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?7eeb54583579fabc0878be210d6ad60a";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();

	

	$(function () {
		const btw = new BTWPlugin();
	    btw.init({
	        id: 'container',
	        blogId: '22377-1706525467336-300',
	        name: '月伴飞鱼',
	        qrcode: '/小程序码.jpg',
	        keyword: '验证码',
	        btnText: '为防止机器刷接口，需要完成人机检测',
        	cookieAge: 1
	    });

	    var contents = document.getElementsByClassName("content999");
	    //监听文章内容的copy事件
	    contents[0].addEventListener('copy',function(e){
	        setClipboardText(e);
	    });

	    function setClipboardText(event){
	        // clipboardData 对象是为通过编辑菜单、快捷菜单和快捷键执行的编辑操作所保留的，也就是你复制或者剪切内容
	        let clipboardData = event.clipboardData || window.clipboardData;

	        // 如果未复制或者未剪切，则return出去
	        if (!clipboardData) { return; }

	        event.preventDefault();

	        // Selection 对象，表示用户选择的文本范围或光标的当前位置。
	        // 声明一个变量接收 -- 用户输入的剪切或者复制的文本转化为字符串
	        let text = window.getSelection().toString();
	    
	        if (text) {
	            // 如果文本存在则先取消文本默认事件
	            event.preventDefault();
	            // 通过调用常clipboardData对象的 setData(format, data) 方法；来设置相关文本
	            // format: 一个DOMString 表示要添加到 drag object的拖动数据的类型。
	            // data: 一个 DOMString表示要添加到 drag object的数据。
	            var copyright = '\n\n'
	            + '\n著作权归作者所有。'
	            + '\n商业转载请联系作者获得授权，非商业转载请注明出处。'
	            + '\n作者: 月伴飞鱼'
	            + '\n原文地址: http://hardyfish.top/2023/10/14/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Spring/'
	    
	            clipboardData.setData('text/plain', text + copyright);
	    
	        }
	    };
	});

	
</script>

<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'container',
        blogId: '22377-1706525467336-300',
        name: '月伴飞鱼',
        qrcode: '/小程序码.jpg',
        keyword: '验证码',
        btnText: '为防止机器刷接口，需要完成人机检测',
        cookieAge: 1
    });

	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?7eeb54583579fabc0878be210d6ad60a";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">月伴飞鱼</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			PV 180986
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			UV 10079
		</span>
	
	<br>
	微信搜索 <a href="https://xiaoflyfish.oss-cn-beijing.aliyuncs.com/image/个人公众号.jpg" target="_blank">月伴飞鱼</a> 关注我
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>