<!DOCTYPE html>
<html lang="en" oncontextmenu="return false;">

<head oncontextmenu="return false;">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="baidu-site-verification" content="codeva-QodU0Nk5F7" />
	<meta name="google-site-verification" content="DbSTw8OJwtH5Qei7n8Jnew0YyQ5naPzdLAPiscu7zQE" />
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">

	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?7eeb54583579fabc0878be210d6ad60a";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>

	
	<!-- title -->
	
	<title>
	
		列表系统 | 
	 
	月伴飞鱼
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/%E5%A4%B4%E5%83%8F.jpg">
	
  
  	
<link rel="stylesheet" href="/css/main.css">

  	
<link rel="stylesheet" href="/css/reward.css">

	
<link rel="stylesheet" href="/css/jquery.fancybox.min.css">

	
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="/lib/highlight/darcula.css">

	
<link rel="stylesheet" href="/css/clipboard-use.css">


	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>


	
<script src="/lib/highlight/highlight.min.js"></script>


	
<script src="https://readmore.openwrite.cn/js/readmore-2.0.js"></script>

	
<script src="/lib/jquery-3.4.1.min.js"></script>

	
<script src="/lib/jquery.pjax.js"></script>


	
<script src="/js/main.js"></script>

	
<script src="/js/jquery.fancybox.min.js"></script>

	
		
<script src="/lib/valine/av-3.0.4-min.js"></script>

		
<script src="/lib/valine/Valine-1.3.10-min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
	
<script src="/js/clipboard.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>

<body oncontextmenu="return false;">
	<header id="header" oncontextmenu="return false;">
    <a id="title" href="/" class="logo">公众号月伴飞鱼</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">关于我</a>
		</li>

		<li class="menu-item">
			<a href="/个人微信.jpeg" class="menu-item-link">联系作者</a>
		</li>

	    <li class="menu-item">
			<a href="/site" class="menu-item-link">关于网站</a>
		</li>

		<li class="menu-item">
			<a href="/个人公众号.jpg" class="menu-item-link" target="_blank">我的公众号</a>
		</li>
		
		<li class="menu-item">
			<a href="https://tech.meituan.com/" class="menu-item-link" target="_blank">
				美团技术团队
			</a>
		</li>
		<li class="menu-item">
			<a href="https://tech.youzan.com/" class="menu-item-link" target="_blank">
				有赞技术团队
			</a>
		</li>
		<!--<li class="menu-item">
			<select class="menu-item-link menu-item-select">
				<option class="menu-item-link"  value="volvo">Volvo</option>
				<option class="menu-item-link"  value="saab">Saab</option>
				<option class="menu-item-link"  value="fiat">Fiat</option>
				<option class="menu-item-link"  value="audi">Audi</option>
			</select>
		</li>-->
	</ul>
</header>

	<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="按目录搜索一下">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										AI相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/01/14/AI%E7%9B%B8%E5%85%B3/AIGC/">
										AIGC
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/03/AI%E7%9B%B8%E5%85%B3/ChatGPT/">
										ChatGPT
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/03/07/AI%E7%9B%B8%E5%85%B3/Sora/">
										Sora
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/03/01/AI%E7%9B%B8%E5%85%B3/%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B/">
										提示词工程
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										个人相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/HBase%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">
										HBase最佳实践
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E4%BA%A4%E6%98%93%E7%B3%BB%E7%BB%9F/">
										交易系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E5%88%97%E8%A1%A8%E7%B3%BB%E7%BB%9F/">
										列表系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/21/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E5%95%86%E5%93%81%E7%B3%BB%E7%BB%9F/">
										商品系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90/">
										学习资源
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E5%B9%BF%E5%91%8A%E7%B3%BB%E7%BB%9F/">
										广告系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E5%BA%93%E5%AD%98%E7%B3%BB%E7%BB%9F/">
										库存系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/">
										生活相关
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F/">
										电商系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E7%9B%B8%E5%85%B3%E5%8D%9A%E4%B8%BB/">
										相关博主
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7/">
										相关工具
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E7%BE%A4%E7%BB%84%E7%B3%BB%E7%BB%9F/">
										群组系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/21/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E8%90%A5%E9%94%80%E7%B3%BB%E7%BB%9F/">
										营销系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/21/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E8%B5%84%E6%BA%90%E4%BD%8D%E7%B3%BB%E7%BB%9F/">
										资源位系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E8%BD%AC%E4%BB%8B%E7%BB%8D/">
										转介绍
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E9%85%8D%E7%BD%AE%E7%B3%BB%E7%BB%9F/">
										配置系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										中间件
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/Dubbo/">
										Dubbo
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/12/19/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/">
										Elasticsearch
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/Netty/">
										Netty
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/25/%E4%B8%AD%E9%97%B4%E4%BB%B6/Solr/">
										Solr
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/19/%E4%B8%AD%E9%97%B4%E4%BB%B6/ZooKeeper/">
										ZooKeeper
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										产品相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/02/18/%E4%BA%A7%E5%93%81%E7%9B%B8%E5%85%B3/%E5%B9%BF%E5%91%8A%E4%B8%9A%E5%8A%A1/">
										广告业务
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/18/%E4%BA%A7%E5%93%81%E7%9B%B8%E5%85%B3/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/">
										推荐系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/06/%E4%BA%A7%E5%93%81%E7%9B%B8%E5%85%B3/%E7%94%A8%E6%88%B7%E5%A2%9E%E9%95%BF/">
										用户增长
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										代码思想
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/12/15/%E4%BB%A3%E7%A0%81%E6%80%9D%E6%83%B3/CodeReview/">
										CodeReview
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/02/%E4%BB%A3%E7%A0%81%E6%80%9D%E6%83%B3/%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84/">
										代码重构
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										前端相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/CSS/">
										CSS
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/26/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/React/">
										React
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/26/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/Vue/">
										Vue
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/12/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">
										小程序
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										基础知识
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/11/27/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/JVM/">
										JVM
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%88%86%E5%B8%83%E5%BC%8F/">
										分布式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/12/10/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">
										并发编程
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
										设计模式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										大数据相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/02/21/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/DataX/">
										DataX
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/25/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Doris/">
										Doris
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/20/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Flink/">
										Flink
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/21/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Hadoop/">
										Hadoop
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/07/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Hive/">
										Hive
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/23/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/SQOOP/">
										SQOOP
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/20/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3/Spark/">
										Spark
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										学习专栏
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/04/05/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/22%E8%AE%B2%E9%80%9A%E5%85%B3Go%E8%AF%AD%E8%A8%80/">
										22讲通关Go语言
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/03/25/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/23%E8%AE%B2%E6%90%9E%E5%AE%9A%E5%90%8E%E5%8F%B0%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98/">
										23讲搞定后台架构实战
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/04/18/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/Dubbo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%AE%9E%E6%88%98/">
										Dubbo源码解读与实战
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/16/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/">
										从0开始学架构
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/31/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/%E4%BB%A3%E7%A0%81%E4%B9%8B%E4%B8%91/">
										代码之丑
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/26/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/%E5%A4%A7%E5%8E%82%E6%99%8B%E5%8D%87%E6%8C%87%E5%8D%97/">
										大厂晋升指南
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/19/%E5%AD%A6%E4%B9%A0%E4%B8%93%E6%A0%8F/%E5%A6%82%E4%BD%95%E6%88%90%E4%B8%BA%E5%AD%A6%E4%B9%A0%E9%AB%98%E6%89%8B/">
										如何成为学习高手
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										学习书籍
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/02/05/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/HBase%E4%B8%8D%E7%9D%A1%E8%A7%89%E4%B9%A6/">
										HBase不睡觉书
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/02/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">
										Java并发编程实战
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/02/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/">
										Java并发编程的艺术
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/16/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/">
										Java开发手册
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/03/22/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/MySQL%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/">
										MySQL技术内幕
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/03/23/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">
										Redis设计与实现
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/03/11/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E4%BA%BF%E7%BA%A7%E6%B5%81%E9%87%8F%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/">
										亿级流量网站架构核心技术
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/05/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/">
										代码整洁之道
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/03/03/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84/">
										大型网站技术架构
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/07/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F/">
										大型网站系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/06/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA/">
										深入理解Java虚拟机
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/08/%E5%AD%A6%E4%B9%A0%E4%B9%A6%E7%B1%8D/%E8%8B%B1%E8%AF%AD%E9%AD%94%E6%B3%95%E5%B8%88%E4%B9%8B%E8%AF%AD%E6%B3%95%E4%BF%B1%E4%B9%90%E9%83%A8/">
										英语魔法师之语法俱乐部
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										工具相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/11/09/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/Arthas/">
										Arthas
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/24/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/ChatGPT/">
										ChatGPT
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/21/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/GIT/">
										GIT
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/21/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/Hexo/">
										Hexo
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/21/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/MAC/">
										MAC
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/01/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/Maven/">
										Maven
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/09/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/PlantUML/">
										PlantUML
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/22/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/UTools/">
										UTools
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">
										实用工具
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										成长相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/03/26/%E6%88%90%E9%95%BF%E7%9B%B8%E5%85%B3/%E5%B7%A5%E4%BD%9C%E7%9B%B8%E5%85%B3/">
										工作相关
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/31/%E6%88%90%E9%95%BF%E7%9B%B8%E5%85%B3/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">
										技术学习
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/07/%E6%88%90%E9%95%BF%E7%9B%B8%E5%85%B3/%E8%AF%BB%E4%B9%A6%E8%AE%A1%E5%88%92/">
										读书计划
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/09/%E6%88%90%E9%95%BF%E7%9B%B8%E5%85%B3/%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3/">
										面试相关
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										数据库
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/02/06/%E6%95%B0%E6%8D%AE%E5%BA%93/ClickHouse/">
										ClickHouse
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/27/%E6%95%B0%E6%8D%AE%E5%BA%93/HBase/">
										HBase
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/09/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/">
										MongoDB
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/12/02/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">
										MySQL
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/21/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/">
										Redis
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/04/07/%E6%95%B0%E6%8D%AE%E5%BA%93/TIDB/">
										TIDB
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										文章速读
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/03/18/%E6%96%87%E7%AB%A0%E9%80%9F%E8%AF%BB/%E5%A4%A7%E5%8E%82%E6%96%87%E7%AB%A0/">
										大厂文章
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										服务器
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E6%9C%8D%E5%8A%A1%E5%99%A8/Docker/">
										Docker
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/09/%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/">
										Nginx
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/03/%E6%9C%8D%E5%8A%A1%E5%99%A8/Tomcat/">
										Tomcat
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/09/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86/">
										运维知识
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										架构相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/21/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/DDD/">
										DDD
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/02/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E6%9E%B6%E6%9E%84%E5%9B%BE/">
										架构图
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/02/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0/">
										架构学习
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/26/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E7%B3%BB%E7%BB%9F%E4%BF%9D%E9%9A%9C/">
										系统保障
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/31/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD/">
										系统性能
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/26/%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">
										系统设计
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										框架相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/01/07/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Caffeine/">
										Caffeine
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/06/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Guava/">
										Guava
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/15/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/JWT/">
										JWT
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/08/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/MyBatis/">
										MyBatis
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/14/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/RPC%E6%A1%86%E6%9E%B6/">
										RPC框架
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/26/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Seata/">
										Seata
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/03/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/ShardingSphere/">
										ShardingSphere
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/14/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Spring/">
										Spring
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/03/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/Thrift/">
										Thrift
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/29/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/XXLJOB/">
										XXLJOB
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/10/%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3/%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">
										开源框架
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										消息队列
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/KAFKA/">
										KAFKA
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/20/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/">
										RabbitMQ
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/07/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/">
										RocketMQ
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										源码相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/12/13/%E6%BA%90%E7%A0%81%E7%9B%B8%E5%85%B3/RocketMQ/">
										RocketMQ
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										生活相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/02/24/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E6%B3%95%E5%BE%8B/">
										法律
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/12/17/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E7%83%B9%E9%A5%AA/">
										烹饪
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/10/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E7%94%B5%E5%BD%B1/">
										电影
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/10/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E7%94%B5%E8%A7%86%E5%89%A7/">
										电视剧
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/11/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E7%BA%AA%E5%BD%95%E7%89%87/">
										纪录片
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/09/%E7%94%9F%E6%B4%BB%E7%9B%B8%E5%85%B3/%E9%9F%B3%E4%B9%90/">
										音乐
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										算法相关
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/11/26/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/LeetCode/">
										LeetCode
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/11/26/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/%E5%89%91%E6%8C%87OFFER/">
										剑指OFFER
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/11/25/%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3/%E9%9D%A2%E8%AF%95%E7%AE%97%E6%B3%95/">
										面试算法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										编程语言
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/04/05/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Go%E5%9F%BA%E7%A1%80/">
										Go基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/11/21/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java%E5%9F%BA%E7%A1%80/">
										Java基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/01/29/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Python%E5%9F%BA%E7%A1%80/">
										Python基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										英语相关
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										摩登家庭
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/03/05/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E6%91%A9%E7%99%BB%E5%AE%B6%E5%BA%AD/%E7%AC%AC%E4%B8%80%E5%AD%A3/">
										第一季
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										老友记
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/08/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E8%80%81%E5%8F%8B%E8%AE%B0/%E7%AC%AC%E4%B8%80%E5%AD%A3/">
										第一季
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/08/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E8%80%81%E5%8F%8B%E8%AE%B0/%E7%AC%AC%E4%B8%89%E5%AD%A3/">
										第三季
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/11/23/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E8%80%81%E5%8F%8B%E8%AE%B0/%E7%AC%AC%E4%BA%94%E5%AD%A3/">
										第五季
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										雅思
									</a>
									
							<ul>
								<li class="file">
									<a href="/2024/01/25/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E9%9B%85%E6%80%9D/%E5%89%91%E6%A1%A5%E9%9B%85%E6%80%9D%E5%90%AC%E5%8A%9B%E7%9C%9F%E9%A2%9815/">
										剑桥雅思听力真题15
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/12/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E9%9B%85%E6%80%9D/%E5%89%91%E6%A1%A5%E9%9B%85%E6%80%9D%E5%90%AC%E5%8A%9B%E7%9C%9F%E9%A2%984/">
										剑桥雅思听力真题4
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2024/02/08/%E8%8B%B1%E8%AF%AD%E7%9B%B8%E5%85%B3/%E9%9B%85%E6%80%9D/%E9%9B%85%E6%80%9D%E9%98%85%E8%AF%BB538%E8%80%83%E7%82%B9%E8%AF%8D/">
										雅思阅读538考点词
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										计算机基础
									</a>
									
							<ul>
								<li class="file">
									<a href="/2023/10/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
										操作系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
										数据结构
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/10/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%AE%97%E6%B3%95%E7%9F%A5%E8%AF%86/">
										算法知识
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/12/19/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">
										网络基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title" oncontextmenu="return false;">

	列表系统
</h1>
<div class="article-meta" oncontextmenu="return false;">
	<span>月伴飞鱼</span>
	<span>2024-05-20 18:44:05</span>
    
		<div id="article-categories">
            
                
                    <span>
                        <i class="fa fa-folder" aria-hidden="true"></i>
                        <a href="/categories/个人相关/">个人相关</a>
						
                    </span>
                
            
		</div>
    
</div>

<div id="container" class = "content999" oncontextmenu="return false;">
<!--打赏-->
        <div class="reward">
       <div class="reward-button">赏 <span class="reward-code">
        <span class="alipay-code"> <img class="alipay-img wdp-appear" src="/alipay.png"><b>支付宝打赏</b> </span> 
        <span class="wechat-code"> <img class="wechat-img wdp-appear" src="/weipay.jpeg"><b>微信打赏</b> </span> 
       </div>
      <p class="reward-notice">如果文章对你有帮助，欢迎点击上方按钮打赏作者！</p>
      </div>
      <!--打赏-->
	<div id="article-content">
		<p><strong>背景介绍</strong></p>
<p>商品列表是展销业务的核心功能之一。</p>
<p>线上需要展示商品列表的场景接口大概有30+，这些商品卡片的展示逻辑大部分都是相同的，但也有一些差异点；</p>
<p>线上总共有30个接口左右需要展示商品列表，如猜喜、凑单、菜场、搜索、品类等。</p>
<p>这些商品列表的展示逻辑大部分都是相同的，比如都需要显示出商品图片、价格、标签、促销等信息。</p>
<p>也有一些差异逻辑，比如不同场景下有不同的过滤规则，有些场景需要更多的相关属性如优惠券。</p>
<p>CAPI中商品列表加载逻辑代码重复冗余，流程没有统一抽象，功能点分散，功能扩展性差，没有实现配置化扩展；</p>
<p>CAPI作为一个网关服务逻辑较多，导致项目越来越重，急需减重；</p>
<p>展销capi、营销capi、交易capi在各自业务场景下都需要展示商品列表。</p>
<p><strong>当前的实现存在一些问题：</strong></p>
<p>1）代码重复冗余。各个场景在实现列表功能时很多重复冗余的代码，如有两个重要的listhandle函数功能类似（调用底层多个服务获取商品数据），两个converter中有相似的组装vo的逻辑。</p>
<p>2）流程没有统一抽象。如想对所有场景下的商品列表增加一些干预，则需要修改多处代码。</p>
<p>3）功能扩展性较低。有功能需求都要修改代码，不能方便做到配置化实现。</p>
<p><strong>问题</strong></p>
<p>商品列表的底层数据源是一致的，数据模型和业务逻辑也有很多相同之处，但是目前各服务都是维护了一套自己的代码来实现商品列表功能。</p>
<p>在开发时经常会通过直接复制代码然后再删改的方式来实现功能，研发效率低并且不利于维护扩展。</p>
<p><img src="/images/732.png" alt="图片1"></p>
<p><strong>原因：</strong></p>
<p><strong>商品是各个capi系统都需要使用的核心实体，但是当前商品信息散落在底层多个系统中，没有一个全局统一的地方去进行定义和维护，导致各系统都需要去开发维护一套相似的逻辑。</strong></p>
<p><strong>系统目标</strong></p>
<p>建立商品列表服务，统一管理所有场景下的商品列表逻辑。具备良好的业务抽象和扩展能力，通过配置化方式实现业务功能。</p>
<p>将CAPI中列表加载逻辑全部下沉到列表服务减轻CAPI服务压力；</p>
<p>将获取商品信息（详情、列表）的逻辑封装到公共地方，供各业务方复用，提升研发效率。</p>
<p><img src="/images/733.png" alt="图片2"></p>
<p><strong>总体方案</strong></p>
<p><strong>设计思路</strong></p>
<p>对商品列表逻辑抽象出统一的业务模型，通过对能力的复用来实现标准化功能，通过对能力的组装和扩展来实现差异化功能。</p>
<p><strong>具体包含三块内容：</strong></p>
<p>将庞杂的系统功能细化分解，定义出基础通用的业务能力，可能是一个函数，也可能是一个底层业务服务接口。</p>
<p>能力具备标准化、可扩展、细粒度的特性。</p>
<p>能力的特性包括：</p>
<blockquote>
<p>1）标准化：能力有标准化的接口定义，可以方便地进行调用或者替换。（举例：定义了接口之后，可以方便地实现不同子类进行替换）</p>
<p>2）可扩展：根据不同业务特点，有各种扩展化方案。（举例：修改代码的方式如继承实现、组合、切面；不修改代码的方式，如静态配置、动态配置（mcc、vcc）、业务规则、脚本、spi、第三方jar包）</p>
<p>3）细粒度：粒度越细，可以标准化或者扩展的能力就越多，系统整体的功能就越强。当然也需要结合业务特性，不能无限制的细。（举例：能力1-把整个商品DTO转成VO VS 能力2-把商品DTO中某一个字段转成VO中某一个字段，哪种粒度更合适需要根据业务需求决定）</p>
</blockquote>
<p>选取适合业务特点的流程执行方式，可以将一个个业务能力进行组装调用，完成有关联的业务逻辑。</p>
<p><strong>通常有两类流程执行方式：</strong></p>
<blockquote>
<p>1）复杂流程模型：不同流程节点之间有复杂的分支逻辑，形成一个DAG。如工作流、审批流等场景。</p>
<p>2）串行流程模型：整体流程是多节点串行逻辑，每个节点内部可以再扩展出子节点。如责任链、普通业务逻辑等场景。</p>
<p>3）在元数据配置中定义出各业务场景下的能力、规则及数据。不同业务场景获取不同的配置，通过配置驱动执行引擎调用能力，实现对应的业务功能。</p>
</blockquote>
<p><img src="/images/734.png" alt="图片3"></p>
<p><strong>考虑因素</strong></p>
<table>
<thead>
<tr>
<th>因素</th>
<th>说明</th>
<th>指标值</th>
</tr>
</thead>
<tbody><tr>
<td>业务架构合理性</td>
<td>capi历史悠久，功能较多，代码庞杂，需要考虑合理的架构分层，对各层的职责边界做出合理定义</td>
<td></td>
</tr>
<tr>
<td>通用性</td>
<td>能满足先阶段各个CAPI需要使用的完整的商品数据模型，并统一维护和实现。</td>
<td></td>
</tr>
<tr>
<td>扩展性</td>
<td>业务迭代中可能会增加需要的商品属性，或者属性值发生变化，导致数据模型、调用后端服务的各种流程、计算规则等都会发生变化。随着后续交易平台化的演进，展示服务考虑支持可交易物。</td>
<td></td>
</tr>
<tr>
<td>兼容性</td>
<td>需要能支撑现有业务，在迁移时尽量减少改造工作量，平稳过渡。</td>
<td></td>
</tr>
<tr>
<td>高性能</td>
<td>属于核心链路的一部分，数据源全部依赖后端10多个服务，耗时要低。</td>
<td>tp999：</td>
</tr>
<tr>
<td>高可用</td>
<td>属于核心链路的一部分，需要确保极高的稳定性。</td>
<td></td>
</tr>
</tbody></table>
<p><strong>方案选型</strong></p>
<p>结合当前情况，总结下可选的方案有：</p>
<blockquote>
<p>抽取成sdk，各服务引入jar包使用。</p>
<p>建立rpc服务，各服务通过rpc调用。</p>
</blockquote>
<p><strong>配置方案</strong></p>
<p>确定三个关键问题：</p>
<blockquote>
<p>1）对业务进行抽象。哪些能力，能力与能力之间的依赖关系。</p>
<p>2）确定配置模型。包括 如何根据业务请求定位到业务配置，业务配置内部的组织形式等。</p>
<p>3）确定维护管理方式。包括 配置如何存储，通过什么方式管理等。</p>
</blockquote>
<p><strong>业务架构</strong></p>
<p>“商品统一展示”是从当前capi中剥离出来，会涉及到对上下多个服务改造，这里有必要对整体的架构分层和职责边界做一个讨论约定。</p>
<p><img src="/images/735.png" alt="图片4"></p>
<table>
<thead>
<tr>
<th>分层</th>
<th>定位</th>
<th>系统</th>
<th>领域对象</th>
<th>业务功能</th>
<th>职责边界说明</th>
</tr>
</thead>
<tbody><tr>
<td>网关层</td>
<td>无业务功能，面向技术域</td>
<td>shepherd api</td>
<td>协议安全流量</td>
<td>协议转换：http与rpc协议，报文转换安全防控：认证、鉴权流量管理：限流、熔断、降级</td>
<td>shepherd api本身提供了服务编排能力，但从解耦的角度出发，不应该在该层做编排，这是属于业务领域的事情。</td>
</tr>
<tr>
<td>业务接口层</td>
<td>面向用户操作的复杂业务流程</td>
<td>展销capi</td>
<td>商品菜谱品类资源位榜单门店</td>
<td>来源过滤：客户端、场景、渠道版本控制：abtest策略过滤：显示过滤（有无图片）排序干预显示：样式、提示</td>
<td>一个view（url接口）可能需要多种业务领域实体，对每个业务领域实体，都只需要调用一次后端服务就能获取到所需要的数据，不需要多次调用各种细粒度数据再来组装。符合的有：品类、资源位、标签、菜谱不符合的有：商品</td>
</tr>
<tr>
<td>促销capi</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>聚合服务层</td>
<td>由多个相近领域的服务组合而成，可降低业务接口层的复杂度</td>
<td>商品列表服务</td>
<td>商品展示模型商品标准模型</td>
<td>组装商品展示模型：将各类零散数据聚合成商品展示模型，包括一些样式、提示等根据场景和上下文，组装完整的商品列表</td>
<td>聚合了上层所需要的商品列表数据模型，上层不需要再去额外获取</td>
</tr>
<tr>
<td>基础服务层</td>
<td>独立的原子业务领域，不同场景下可灵活组合不同基础服务</td>
<td>poi、product、price、stock、poicatecquery</td>
<td>大部分都是原子业务领域有一个cquery是聚合领域，把商品部分信息聚合到一个服务中</td>
<td>维护本领域内部实体的增删改查</td>
<td>每个服务都是原子业务，从业务上不可再拆分，相互之间独立解耦，不依赖于其他服务。由上层服务在流程中组装使用。</td>
</tr>
</tbody></table>
<p><strong>业务抽象</strong></p>
<ul>
<li>梳理业务流程现状</li>
</ul>
<p><img src="/images/736.png" alt="图片5"></p>
<p>统一后的业务流程</p>
<p><img src="/images/737.png" alt="图片6"></p>
<p>抽象后的业务流程和能力：</p>
<p><img src="/images/738.png" alt="图片7"></p>
<p>能力：每个方块代表一个业务能力，如聚合数据、排序、对某个字段设置显示属性等，能力之间可以有关联关系。能力都可以定义业务规则，还可以在前置后置处理中定义扩展。</p>
<p>流程：多个业务能力是串行顺序执行，不同场景可以执行不一样的业务能力集合。比如有的场景会执行4步，有的场景会执行5步等。</p>
<p>场景配置信息就是基于这个模型进行设计的。</p>
<p><strong>配置模型</strong></p>
<p><img src="/images/739.png" alt="图片8"></p>
<p><strong>业务场景</strong></p>
<p>可能导致系统业务逻辑差异的业务要素包括：业务类型、业务模块、版本、渠道、ab策略、用户属性等。</p>
<p>业务类型指大的业务分类，如展销、促销、交易。</p>
<p>业务模块指一个业务类型下面某一个具体的业务功能，如分类sku列表、猜喜列表，不同业务模块会对应不同的前端URL接口。</p>
<p>其他业务要素如版本、渠道、ab策略等都是当前已有概念，不再赘述。</p>
<p>在商品列表业务逻辑中，不同业务类型下商品列表的逻辑无差异，所有差异都可以通过业务模块、版本、渠道、ab策略来决定。</p>
<p>因此将这四个属性抽象成为业务场景，不同的业务场景能定位到一个场景配置，通过配置化方式来实现不同的商品列表逻辑。</p>
<pre><code class="json">&#123;
  &quot;moduleId&quot;:&quot;xxxxx&quot;,
  &quot;moduleName&quot;:&quot;购物车推荐&quot;,
  &quot;startVersion&quot;:&quot;all&quot;,
  &quot;endVersion&quot;:&quot;all&quot;,
  &quot;channel&quot;:[&quot;iphone&quot;,&quot;android&quot;,&quot;wxapp&quot;,&quot;tuanapp&quot;,&quot;dpapp&quot;],
  &quot;abStrategy&quot;: &#123;
    &quot;testKey&quot;:&quot;ab_513_store_cart&quot;,
    &quot;strategyName&quot;:&quot;a&quot;
  &#125;
&#125;
</code></pre>
<p><strong>场景与配置关联</strong></p>
<p>由于不同场景的配置信息可能完全一样，如果每个场景都使用独立的配置信息，会增加维护成本。</p>
<p>因此，将场景和场景配置拆分开，多个场景可以关联到相同的一个场景配置，实现场景配置的复用。</p>
<img src="/images/740.png" alt="图片9" style="zoom:50%;" />

<p><strong>场景配置</strong></p>
<p>根据业务流程抽象，整体业务流程节点被拆解为三类任务：scences、stage、step。</p>
<p>每个任务都有名称、类型、前置处理、后置处理、业务规则等属性，对于scences类型和stage类型的任务，可以定义多个子任务。</p>
<p>而对于step类型任务，是属于模型中的最底层节点，不能再定义子任务。</p>
<p>整体关系如下：</p>
<p><img src="/images/741.png" alt="图片10"></p>
<pre><code class="json">&#123;
  &quot;name&quot;:&quot;Scences&quot;,
  &quot;type&quot;:&quot;scences&quot;,
  &quot;preHandle&quot;: &quot;class::function&quot;,
  &quot;postHandle&quot;: &quot;class::function&quot;,
  &quot;rule&quot;:&#123;&#125;,
    &quot;subTaskList&quot;: [
    &#123;
      &quot;name&quot;:&quot;aggregate&quot;,
          &quot;type&quot;:&quot;stage&quot;,
          &quot;preHandle&quot;: &quot;class::function&quot;,
          &quot;postHandle&quot;: &quot;class::function&quot;,
          &quot;rule&quot;:&#123;&#125;,
    &#125;,
    &#123;
      &quot;name&quot;:&quot;render&quot;,
          &quot;type&quot;:&quot;stage&quot;,
          &quot;preHandle&quot;: &quot;class::function&quot;,
          &quot;postHandle&quot;: &quot;class::function&quot;,
          &quot;rule&quot;:&#123;&#125;,
      &quot;subTaskList&quot;: [
        &#123;
            &quot;name&quot;: &quot;BaseRender&quot;,
            &quot;type&quot;: &quot;step&quot;
                &#125;,
                &#123;
                    &quot;name&quot;: &quot;SubscriptionRender&quot;,
                    &quot;type&quot;: &quot;step&quot;
                &#125;
        ]
    &#125; 
  ]
&#125;
</code></pre>
<p><strong>默认配置</strong></p>
<p>配置信息是整个系统功能的关键依赖，需要保障正确性。</p>
<p>比如：如果遗漏了某个场景的配置，如何确保线上功能还能正常使用而不是空白或出错页面？</p>
<p>另外，由于业务场景有会有数十种之多，并且模型比较复杂，需要考虑降低维护成本。</p>
<p>比如 新增一个后端调用服务，如何快速地为所有业务场景加上该项配置？很多模板配置可能只有某几项关键配置不同，如何降低配置成本？</p>
<p>这里引入默认配置，通过对默认配置的继承和异常兜底，来一并解决正确性和维护性两个问题。</p>
<ul>
<li><strong>默认配置</strong></li>
</ul>
<p>在整个配置体系中，会有一个默认场景配置，里面包含所有的配置项和默认值。这个默认配置是所有场景功能的精简集合，能支撑列表逻辑正常执行。</p>
<ul>
<li><strong>配置继承</strong></li>
</ul>
<p>其他自定义的场景配置都可以继承这个默认配置。如果某个场景只有少量配置项和默认配置不同，则只需要针对这几个配置项赋值即可，其他没有设置的配置项，则以默认配置中的信息为准。比如 新增一个后端调用服务，可以直接在默认配置上增加，其他业务场景配置不需要做任何修改即可生效。</p>
<p>通过这种方式，可以最大程度进行配置复用，降低维护成本。</p>
<ul>
<li><strong>配置兜底</strong></li>
</ul>
<p>有了默认场景配置，就可以把它作为异常时的兜底措施。当遗漏了某个场景的配置，可使用返回默认配置来执行逻辑，保证线上功能还能正常使用而不是空白或出错页面。</p>
<p>整体逻辑如下：</p>
<p><img src="/images/742.png" alt="图片11"></p>
<p>注：在使用兜底默认配置时，虽然业务不会出错，但仍反应了当前系统存在问题。这里会通过监控报警机制让研发尽快知晓介入。</p>
<p><strong>配置管理</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>方案</th>
<th>存储结构</th>
<th>配置更新方式</th>
<th>配置加载</th>
<th>配置同步</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>方案一</td>
<td>db存储+管理后台</td>
<td>两张表：场景、模板配置</td>
<td>开发后台人工操作sql</td>
<td>服务启动时，一次性从数据库读入所有配置信息，放入本地缓存中</td>
<td>异步线程定时从数据库更新</td>
<td>通过后台界面操作，能较好保证配置正确性</td>
<td>开发后台有一定成本</td>
</tr>
<tr>
<td>方案二</td>
<td>vcc存储管理</td>
<td>两个group：场景、模板配置</td>
<td>vcc后台</td>
<td>使用时通过vcc client读取</td>
<td>vcc client定义更新</td>
<td>不需要开发，接入成本低</td>
<td>需要人工确保场景与模板关联关系的正确性</td>
</tr>
</tbody></table>
<p>从之前配置模型可以看出，整个配置结构是比较复杂的，需要通过后台界面来操作，才能保证正确性。并且在后台界面中，可以较方便清晰的查询理解当前所有配置信息。</p>
<p>因此，基于正确性和可维护性两方面的考虑，选定方案一，使用db+管理后台来管理配置。</p>
<p><strong>执行引擎</strong></p>
<p>执行引擎分两种：</p>
<p>一种是任务引擎：根据每个场景配置的能力及能力之间的关系，执行每个具体的业务能力，实现整体流程的业务逻辑。</p>
<p>另一种是规则引擎：根据每个场景中各能力配置的业务规则或前置后置规则，执行规则脚本，实现能力扩展的业务逻辑。</p>
<p><strong>任务引擎</strong></p>
<p>根据业务抽象，定义了三种类型的能力：scences、stage、step。scences可以包含多个stage，一个stage可以包含多个step。</p>
<p>对应实际的商品列表业务中，stage类型有 聚合、过滤、排序、渲染等不同的能力，在渲染过程中，还会进一步拆分为多个step。</p>
<p>不同的能力虽然其内部业务逻辑不一样，但可以抽象成统一的task任务来执行。如下图所示：</p>
<p><img src="/images/743.png" alt="图片12"></p>
<p>将执行各种能力都抽象成task之后，任务引擎本身不包含或者感知任何业务逻辑，执行逻辑很统一：读取task配置，执行前置处理器，执行自身业务逻辑，执行后置处理器。所有的操作都是调用task的executeTask方法进行处理，不关注具体实现子类的操作。在前后task之间如果需要共享数据，可以通过context来传递。</p>
<p><strong>具体的执行方式：</strong></p>
<p>1）前置和后置处理器是自定义脚本，通过规则引擎解析来执行逻辑。</p>
<p>2）如果没有子任务，则使用业务规则(rule)和请求上下文(context)处理逻辑。rule是对该task业务逻辑差异化的抽象，可以根据不同的场景配置不同的规则，来实现差异化逻辑。</p>
<p>3）如果有配置子任务列表，则递归调用子任务的处理函数。</p>
<p>假如后续业务流程发生变化—如增加或者减少了任务，任务内部业务逻辑有修改，任务引擎本身不需要做任何改动，只需要更改场景配置信息即可。</p>
<p>最终实现整个业务流程可以完全通过场景配置来驱动任务引擎运转，任务引擎不感知任何业务逻辑，可以灵活方便地扩展。</p>
<img src="/images/744.png" alt="图片13" style="zoom:50%;" />

<p><strong>规则引擎</strong></p>
<p>根据能力扩展需求，规则引擎需要能支持对表达式、动态脚本计算。</p>
<p>调研了多个引擎：Groovy、QLExpress、Aviator、Drools后，目前选定使用Groovy作为系统规则引擎的实现。</p>
<p>详细对比：</p>
<table>
<thead>
<tr>
<th>引擎名称</th>
<th>类型</th>
<th><strong>优点</strong></th>
<th>缺点</th>
<th>使用案例</th>
</tr>
</thead>
<tbody><tr>
<td>Groovy<a target="_blank" rel="noopener" href="https://groovy-lang.org/">https://groovy-lang.org/</a></td>
<td>脚本引擎</td>
<td>特性支持全面的脚本语言，跟java融合较好,可以引用java各种特性。</td>
<td></td>
<td>公司内部rpc分流、zebra分库分表路由规则</td>
</tr>
<tr>
<td>QLExpress<a target="_blank" rel="noopener" href="https://github.com/alibaba/QLExpress">https://github.com/alibaba/QLExpress</a></td>
<td>脚本引擎</td>
<td>1、线程安全，引擎运算过程中的产生的临时变量都是threadlocal类型。2、高效执行，比较耗时的脚本编译过程可以缓存在本地机器，运行时的临时变量创建采用了缓冲池的技术，和groovy性能相当。3、弱类型脚本语言，和groovy，javascript语法类似，虽然比强类型脚本语言要慢一些，但是使业务的灵活度大大增强。4、安全控制,可以通过设置相关运行参数，预防死循环、高危系统api调用等情况。5、代码精简，依赖最小，250k的jar包适合所有java的运行环境，在android系统的低端pos机也得到广泛运用。</td>
<td>功能简单，对原始的java代码有一定的兼容性问题，一般需要把数据的类型声明全部去掉，同时不支持异常处理、for循环的集合写法 等</td>
<td>阿里内部</td>
</tr>
<tr>
<td>Aviator<a target="_blank" rel="noopener" href="https://github.com/killme2008/aviatorscript">https://github.com/killme2008/aviatorscript</a></td>
<td>表达式引擎（4.0）脚本引擎（5.0）</td>
<td>4.0之前是一个表达式引擎，不支持 if&#x2F;else 条件语句（仅有三元运算符支持 ?: ），没有内置的 for&#x2F;while 循环支持（虽然你可以用 seq 库类似函数式的方式来处理集合），也没有赋值（后来在 4.0 引入），没有作用域的概念（也在 4.0 引入 lambda 函数后部分实现）等等一般语言常见的能力。在 5.0 这个大版本（也就是本指南介绍的主要版本）将支持上述所有的能力，变成一门通用的脚本语言 AviatorScrip</td>
<td>表达式执行引擎，非规则引擎</td>
<td></td>
</tr>
<tr>
<td>Drools<a target="_blank" rel="noopener" href="https://www.drools.org/">https://www.drools.org/</a></td>
<td>脚本引擎</td>
<td>1.java 语言实现，基于Rate算法，Drools提供了一套功能完整的规则引擎2.规则部分抽离出来后，以规则脚本的形式存放在文件中，实现了规则和业务解耦，方便维护3.Rate算法执行效率较高4.规则支持热部署5.功能完善6.社区活跃</td>
<td>1.由于规则主体DSL是编程语言（支持java、groovy、python），因此仍然需要开发工程师维护2.规则较多时维护成本高3.规则非常适合扁平的规则，对于嵌套条件语义（then里嵌套when…then子句）的规则只能将条件进行笛卡尔积组合以后配置4.drools的底层实现就是解析drl规则文件，如果让业务独立使用配置业务规则，那么需要对业务的规则进行解析转换成对应的drl文件5.DSL学习成本高6. 过于重量级</td>
<td>风控</td>
</tr>
</tbody></table>
<p><strong>业务能力</strong></p>
<p>目前定义了聚合、过滤、排序、干预、渲染等几种业务能力，其中渲染会进一步拆分为更细粒度的业务能力。</p>
<p>每个能力除了自己特有的业务逻辑之外，都有相同的扩展方式：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>扩展方式</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>配置业务规则</td>
<td>配置中可以定义rule，不同能力的rule定义不一样。每个rule都是对业务逻辑差异化的抽象，可以根据不同的场景配置不同的value，来实现差异化逻辑。</td>
<td>如聚合数据时可以将是否调用下游抽取出明确的规则：<code>&quot;promotion&quot;: true&quot;label&quot;: true</code></td>
</tr>
<tr>
<td></td>
<td>配置前置或后置处理脚本</td>
<td>可以为每个能力的执行前后配置脚本，脚本里有自定义的代码，可实现较强的扩展。</td>
<td><code>if ($a == 1) &#123;$b = 2;&#125; else &#123; xxxxx; &#125;</code></td>
</tr>
<tr>
<td></td>
<td>对一个业务功能定义多个能力实现</td>
<td>某个功能在不同场景下有不同的逻辑，不能抽象成统一规则，也无法统一在前置或者后置器中处理时，就需要开发出新的能力实现。</td>
<td>比如不同场景下DTO转VO的逻辑差异较大，可以开发出多个实现：一种是基础的BaseRender，一种是复杂的XXXRender，在不同的场景中可以配置不同的实现。</td>
</tr>
</tbody></table>
<p><strong>聚合数据</strong></p>
<p><strong>说明</strong></p>
<p>调用列表依赖的多个服务，获取商品相关的各类数据，如商品基础信息、促销、优惠券、销量等等。</p>
<pre><code class="json">&#123;
  &quot;name&quot;: &quot;aggregate&quot;,
  &quot;type&quot;: &quot;stage&quot;,
  &quot;preHandle&quot;: &quot;&quot;,
  &quot;postHandle&quot;: &quot;&quot;,
  &quot;rule&quot;: &#123;
    &quot;needService&quot;: &#123;
      &quot;promotion&quot;: true,
      &quot;label&quot;: true,
      &quot;coupon&quot;: true,
      &quot;cookingService&quot;: true,
      &quot;consumerMsg&quot;: true,
      &quot;productLabel&quot;: true,
      &quot;recReason&quot;: true,
      &quot;poiSkuSales&quot;: true,
      &quot;relationSku&quot;: true
    &#125;,
    &quot;needParam&quot;: &#123;
      &quot;needSkuDesc&quot;: true,
      &quot;needCategory&quot;: true,
      &quot;needSkuBrand&quot;: true,
      &quot;needSkuCode&quot;: true,
      &quot;needExtAttr&quot;: true,
      &quot;needQuantity&quot;: true,
      &quot;needSellPoints&quot;: true,
      &quot;needStock&quot;: true,
      &quot;needPrice&quot;: true,
      &quot;needPreSellInfo&quot;: true,
      &quot;needSkuBusiness&quot;: true
    &#125;
  &#125;
&#125;
</code></pre>
<p><strong>服务调用实现</strong></p>
<ul>
<li>编排实现</li>
</ul>
<p>暂时不考虑服务编排中间件。原因：</p>
<p>1）需要调用的服务列表很固定，变化极少，不适合服务编排场景；</p>
<p>2）现有的编排中间件有一些问题风险。</p>
<p><a target="_blank" rel="noopener" href="https://camel.apache.org/">Apache Camel</a> 性能较低 一次执行需要几十毫秒，公司内部的海盗 没有在大规模C端场景下使用的案例。</p>
<p>因此，综合决策 服务调用不使用编排中间件。如果后续有新增依赖服务，直接修改代码即可，总体成本更低。</p>
<ul>
<li>协程调用</li>
</ul>
<p>常规方式是使用异步线程去请求rpc，线程池数量有限，当QPS突增或者后端接口耗时增加时，容易打满线程池，导致服务异常，线程池会成为系统吞吐量的瓶颈。</p>
<p>这里计划使用协程（quasar的协程库）来发起rpc，使用相对较少的线程数量，能支持更多的rpc调用，提升系统吞吐量。</p>
<p>详细对比：</p>
<table>
<thead>
<tr>
<th>选型</th>
<th>实现方式</th>
<th>优点</th>
<th>缺点</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>future</td>
<td>通过mtthrift异步调用方式获取future，在线程池中异步执行</td>
<td>实现方案比较成熟，容易理解维护</td>
<td>系统线程数比较有限，通常在200以内。当QPS增加或者后端接口耗时增加时，会打满线程池，导致服务异常。</td>
<td></td>
</tr>
<tr>
<td>rxjava</td>
<td>使用RxJava库</td>
<td>使用响应式的编程模型简化开发</td>
<td>仍是使用线程</td>
<td></td>
</tr>
<tr>
<td>协程java</td>
<td>使用quasar的协程库</td>
<td>使用相对较少的线程数量，能支持更多的rpc调用，提升系统吞吐量</td>
<td>新组件</td>
<td></td>
</tr>
</tbody></table>
<p><strong>降级兜底</strong></p>
<p>调用下游服务有时会出现异常情况，如网络抖动，服务自身或者下游有故障，导致超时无法获取到相关属性。</p>
<p>比如调用商品cquery服务异常，会导致本次列表请求无法正常处理，返回给客户端的就是空白结果。为了提高服务可用性，可以在此进行降级处理。</p>
<p>方案：</p>
<p>1）调用下游，获取商品各类属性，组装成skuDTO。</p>
<p>2）将skuDTO通过异步线程批量放入缓存中（本地&#x2F;squirrel），过期时间为x分钟。缓存key是poiId+skuId，缓存value是SkuDTO。它需要排除掉<strong>和用户属性相关的信息</strong>，如促销、消息订阅等。</p>
<p>3）当下游出现故障符合降级策略后，rhino降级执行fallback方法，使用skuIdList从缓存中批量查询skuDTO。此时，可能查询到id对应的所有sku数据，也可能查询到部分数据。</p>
<p>4）继续进行后续逻辑处理，组装成vo后返回给capi层。</p>
<p><strong>过滤</strong></p>
<p>对列表按业务规则进行过滤，去除掉不符合业务要求的数据，可能会减少列表中的商品数量。</p>
<p><strong>实现</strong></p>
<p>提供两种过滤器：</p>
<table>
<thead>
<tr>
<th>过滤器</th>
<th>能力</th>
<th>配置内容</th>
</tr>
</thead>
<tbody><tr>
<td>SimpleFilter</td>
<td>按当前系统已有的ListFilter功能， 过滤器默认实现了对 电子卡、黑名单、券包、售卖状态、售卖时间、售罄、定期售的过滤能力。</td>
<td>true或者false</td>
</tr>
<tr>
<td>ScriptFilter</td>
<td>可以对dto中的任意字段进行过滤。</td>
<td><code>每个规则为一个脚本，语法支持 ==, !=, &gt;,&gt;=,&lt;,&lt;=,in, not in等比较运算符和 &amp;&amp;, || 逻辑运算符。示例： fieldA==123 &amp;&amp; fieldB not in (1,2,3)、fieldA !=123 &amp;&amp; fieldB in (1,2,3)</code></td>
</tr>
</tbody></table>
<p>SimpleFilter配置示例：</p>
<pre><code class="json">&#123;
    &quot;name&quot;: &quot;SimpleFilter&quot;,
    &quot;type&quot;: &quot;stage&quot;,
    &quot;preHandle&quot;: &quot;&quot;,
    &quot;postHandle&quot;: &quot;&quot;, 
    &quot;rule&quot;: &#123;
      &quot;showNotInSellTime&quot;: false,
      &quot;showNotEnoughStock&quot;: false,
      &quot;showNotSellState&quot;: false,
      &quot;showTomorrowSell&quot;: false,
      &quot;showFixedSell&quot;: false
    &#125;
&#125;
</code></pre>
<p>ScriptFilter配置示例：</p>
<pre><code class="json">&#123;
  &quot;name&quot;: &quot;ScriptFilter&quot;,
  &quot;type&quot;: &quot;stage&quot;,
  &quot;preHandle&quot;: &quot;&quot;,
  &quot;postHandle&quot;: &quot;&quot;,
  &quot;rule&quot;: &#123;
    &quot;script&quot;: [
      &quot;fieldA==123 || fieldA==234&quot;,
      &quot;poiSkuSaleStatus==1&quot;
    ]
  &#125;
&#125;
</code></pre>
<p><strong>排序</strong></p>
<p>对列表按业务规则进行排序，排序时不会修改列表中的商品数量。</p>
<p><strong>实现</strong></p>
<p>排序支持先按条件分组，再对组内商品排序。</p>
<p>每个分组条件中，可以指定过滤规则，比如按某个属性是否等于某个值来过滤出符合条件的组内商品。在分组内部，可以进一步指定排序的字段、顺序和数量限制。</p>
<p>注意：由于配置了分组规则（filter）和数量限制（limit），在配置不全的情况下可能导致配置指定的结果列表少于原始输入的结果列表。</p>
<p>排序操作的原则是不会修改列表数量，因此如果出现上述情况，默认的处理机制会把剩余的所有数据添加到列表尾部，确保输入输出的数量一致。</p>
<p>如果需要对列表数量进行调整，可以在上一个stage（<strong>过滤操作</strong>）中进行配置。</p>
<p>场景配置示例：</p>
<pre><code class="json">  &#123;
    &quot;name&quot;: &quot;defaultSort&quot;,
    &quot;type&quot;: &quot;stage&quot;,
    &quot;preHandle&quot;: &quot;&quot;,
    &quot;postHandle&quot;: &quot;&quot;,
    &quot;rule&quot;: &#123;
      &quot;group&quot;: [
        &#123;//分组1
          &quot;filterscript&quot;: &quot;key1==123&quot;, //过滤脚本
          &quot;orderby&quot;: &quot;sales&quot;, //按某个字段排序
          &quot;sort&quot;: &quot;desc&quot;//正序倒序
          &quot;limit&quot;: &quot;0,3&quot; //个数限制
        &#125;,
        &#123;//分组2
          &quot;filterscript&quot;: &quot;key1==123&quot;, //过滤脚本
          &quot;orderby&quot;: &quot;sales&quot;, //按某个字段排序
          &quot;sort&quot;: &quot;desc&quot;//正序倒序
        &#125;
       ]
    &#125;
&#125;
</code></pre>
<p>整个列表统一按照销量排序：</p>
<pre><code class="json">&#123;
    &quot;name&quot;: &quot;defaultSort&quot;,
    &quot;type&quot;: &quot;stage&quot;,
    &quot;preHandle&quot;: &quot;&quot;,
    &quot;postHandle&quot;: &quot;&quot;,
    &quot;rule&quot;: &#123;
      &quot;group&quot;: [
        &#123; 
          &quot;filter&quot;: null,     //表示不过滤
          &quot;orderby&quot;: &quot;sales&quot;, //销量
          &quot;sort&quot;: &quot;desc&quot;      //倒序
        &#125;
       ]
    &#125;
&#125;
</code></pre>
<p>按销售类型分组排序：非售罄的商品排在前面，售罄的商品排在后面，每类商品内部的顺序和初试顺序一致：</p>
<pre><code class="json">&#123;
    &quot;name&quot;: &quot;defaultSort&quot;,
    &quot;type&quot;: &quot;stage&quot;,
    &quot;preHandle&quot;: &quot;&quot;,
    &quot;postHandle&quot;: &quot;&quot;,
    &quot;rule&quot;: &#123;
      &quot;group&quot;: [
        &#123;       
          &quot;filter&quot;: &quot;skuSellType!=6&quot;,  //销售类型不等于6
          &quot;orderby&quot;: null,               //不设置代表按默认顺序
          &quot;sort&quot;: null
        &#125;,
        &#123;       
          &quot;filter&quot;: &quot;skuSellType==6&quot;,  //销售类型等于6
          &quot;orderby&quot;: null,               //不设置代表按默认顺序
          &quot;sort&quot;: null
        &#125;
       ]
    &#125;
&#125;
</code></pre>
<p><strong>渲染</strong></p>
<p>将DTO转成VO，可供前端直接展示。</p>
<p><strong>实现</strong></p>
<p>渲染的逻辑较复杂，有变化的逻辑在于：</p>
<p>1）不同场景下，需要设置的字段不一样。比如使用SkuV2PagedListVO的场景，需要设置很多新的属性（如入榜理由、商详图、推荐理由、关联理由等）。使用SkuPagedListVO的场景，不需要设置上述字段。</p>
<p>2）不同场景下，同一个字段设置的逻辑不一样？比如使用SkuSearchPagedListVO的场景，当SkuPagedListType为ALL时，会重新设置ItemList的值。</p>
<p>因此，需要将一个渲染stage进一步拆解为多个step。最极端场景下，针对VO的每个属性定义一个函数，在配置中根据场景组装所需要的字段，这是最复杂的扩展方式。</p>
<p>根据当前实际场景需要，可以减少step的配置。标准化的处理封装成一个基础Render，处理各场景下逻辑相同的字段，其他有逻辑差异的字段分别封装为多个Render。</p>
<pre><code>&#123;
  &quot;name&quot;: &quot;render&quot;,
  &quot;type&quot;: &quot;stage&quot;,
  &quot;preHandle&quot;: &quot;&quot;,
  &quot;handle&quot;: &quot;&quot;,
  &quot;postHandle&quot;: &quot;&quot;,
  &quot;subTaskList&quot;: [&#123;
      &quot;name&quot;: &quot;BaseRender&quot;,
      &quot;type&quot;: &quot;step&quot;
    &#125;,
    &#123;
      &quot;name&quot;: &quot;SubscriptionRender&quot;,
      &quot;type&quot;: &quot;step&quot;
    &#125;
  ]
&#125;
</code></pre>
<p><strong>数据模型</strong></p>
<p>梳理了几类大的场景，所需要的信息都一样。在实现中，数据模型会取各场景的合集，确保能支持所有场景。</p>
<table>
<thead>
<tr>
<th>场景 \ 所需数据</th>
<th>商品</th>
<th>促销</th>
<th>订阅消息</th>
<th>标签</th>
<th>券</th>
<th>加工服务</th>
<th>推荐理由</th>
<th>销量</th>
<th>关联SKU</th>
</tr>
</thead>
<tbody><tr>
<td>猜喜</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td>凑单</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td>菜场</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td>搜索</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td>品类</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
</tbody></table>
<p><strong>模型定义</strong></p>
<p>目前商品属性比较多，约50多个，如果将所有属性全部打平存在一个对象中，不利于理解维护。</p>
<p>另外，如果要使用缓存，最好能按照上游不同的请求参数来获取不同的缓存属性，而不是直接存取一个巨大的对象，需要考虑控制商品缓存对象的粒度。</p>
<p>因此，数据模型在实现时可以分为两层，第一层定义了完整的商品属性集合，第二层是按领域划分的不同类别的属性。</p>
<p>每个属性的类型都与前端解耦，不涉及到文案、样式、按钮等展示信息，如价格相关的都是定义为long型，由capi根据需要拼装成带符号的展示价格。</p>
<p>在客户端请求时。</p>
<p>在缓存管理时，可以按skuId+类别进行构建，减小对象粒度。</p>
<p><strong>扩展性考虑</strong></p>
<p>在数据模型扩展时，需要考虑对 数据库表、缓存、接口对象的影响，系统如何最小成本的支持（不修改或者尽量少修改）。</p>
<p>目前本服务的数据是聚合下游多个服务产生，自身没有数据库表，所以不用考虑数据库表的影响，直接在对象上增加分类或者属性即可。</p>
<p><strong>接口</strong></p>
<ul>
<li><strong>输入：</strong></li>
</ul>
<p>参数名类型含义是否必填说明poiIdLong门店id是<code>skuIdListList&lt;Long&gt;</code>商品id列表是不能超过200个requestInfoRequestInfo通用请求信息是</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>含义</th>
<th>是否必填</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>poiId</td>
<td>Long</td>
<td>门店id</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>skuIdList</td>
<td><code>List&lt;Long&gt;</code></td>
<td>商品id列表</td>
<td>是</td>
<td>不能超过200个</td>
</tr>
<tr>
<td>requestInfo</td>
<td>RequestInfo</td>
<td>通用请求信息</td>
<td>是</td>
<td></td>
</tr>
</tbody></table>
<p>注：在搜索场景中，可能会出现skuIdList中包含多种来源的商品id，比如有的是搜索sku，有的是菜谱相关sku，有的是banner相关sku。不同来源的skuId，在过滤排序时可能有不同的逻辑。</p>
<p>请求参数中，需要增加多个skuIdList用以区分。</p>
<p>方案一：将现有的 <code>skuIdList（List&lt;Long&gt;）变成 skuIdListMap（Map&lt;String, List&lt;Long&gt;&gt;）</code></p>
<p>方案二：这种场景很少，在requestInfo中，增加扩展字段来区分。</p>
<ul>
<li><strong>输出：</strong></li>
</ul>
<p>参数名类型含义是否必填说明skuListVOSkuListVO商品列表VO是</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>含义</th>
<th>是否必填</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>skuListVO</td>
<td>SkuListVO</td>
<td>商品列表VO</td>
<td>是</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><strong>类型定义：</strong></li>
</ul>
<p>类型属性类型含义是否必填说明RequestInfomoduleIdString模块Id是appVersionString版本号是channelString渠道是userIdLong用户id是uuidString设备唯一编号是</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>属性</th>
<th>类型</th>
<th>含义</th>
<th>是否必填</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>RequestInfo</td>
<td>moduleId</td>
<td>String</td>
<td>模块Id</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>appVersion</td>
<td>String</td>
<td>版本号</td>
<td>是</td>
<td></td>
<td></td>
</tr>
<tr>
<td>channel</td>
<td>String</td>
<td>渠道</td>
<td>是</td>
<td></td>
<td></td>
</tr>
<tr>
<td>userId</td>
<td>Long</td>
<td>用户id</td>
<td>是</td>
<td></td>
<td></td>
</tr>
<tr>
<td>uuid</td>
<td>String</td>
<td>设备唯一编号</td>
<td>是</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>SkuDTO</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>poiId</td>
<td>Long</td>
<td>门店id</td>
</tr>
<tr>
<td>skuId</td>
<td>Long</td>
<td>商品id</td>
</tr>
<tr>
<td>poiSkuInfo</td>
<td>TCPoiSkuInfo</td>
<td>商品信息</td>
</tr>
<tr>
<td>skuTPromotion</td>
<td>TSkuPromotionInfo</td>
<td>促销信息</td>
</tr>
<tr>
<td>skuMsgStatus</td>
<td>Integer</td>
<td>订阅消息状态</td>
</tr>
<tr>
<td>poiSkuLabel</td>
<td>TCPoiSkuLabel</td>
<td>标签</td>
</tr>
<tr>
<td>couponTag</td>
<td>String</td>
<td>满返券标签</td>
</tr>
<tr>
<td>cooking</td>
<td>List</td>
<td>加工服务</td>
</tr>
<tr>
<td>skuRecReason</td>
<td>TRecReason</td>
<td>推荐理由</td>
</tr>
<tr>
<td>tPoiSkuSales</td>
<td>TPoiSkuSales</td>
<td>销量</td>
</tr>
<tr>
<td>relationSku</td>
<td>List</td>
<td>关联SKU</td>
</tr>
</tbody></table>
<p>SkuListDTO</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>skuDTOList</td>
<td><code>List&lt;SkuDTO&gt;</code></td>
<td>dto列表</td>
</tr>
<tr>
<td>poiId</td>
<td>Long</td>
<td>门店id</td>
</tr>
<tr>
<td>AppVersion</td>
<td>String</td>
<td>版本</td>
</tr>
<tr>
<td>Channel</td>
<td>String</td>
<td>渠道</td>
</tr>
<tr>
<td>Offset</td>
<td>Integer</td>
<td>请求偏移量</td>
</tr>
<tr>
<td>Limit</td>
<td>Integer</td>
<td>请求数量</td>
</tr>
<tr>
<td>total</td>
<td>Integer</td>
<td>总数</td>
</tr>
<tr>
<td>tcProductLabelTResponse</td>
<td>TCProductLabelTResponse</td>
<td>全局活动标签</td>
</tr>
<tr>
<td>NotFilterStockSkuIdList</td>
<td>List</td>
<td>不过滤库存的skuIds</td>
</tr>
<tr>
<td>serviceTags</td>
<td>List</td>
<td>服务标签</td>
</tr>
</tbody></table>
<p>SkuVO</p>
<table>
<thead>
<tr>
<th>领域</th>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>商品属性</td>
<td>skuId</td>
<td>Long</td>
<td>skuBaseId</td>
</tr>
<tr>
<td>skuTitle</td>
<td>StyleText</td>
<td>sku标题</td>
<td></td>
</tr>
<tr>
<td>skuSubTitle</td>
<td>StyleText</td>
<td>sku副标题</td>
<td></td>
</tr>
<tr>
<td>picUrl</td>
<td>String</td>
<td>图片url地址</td>
<td></td>
</tr>
<tr>
<td>gifPicUrl</td>
<td>String</td>
<td>动图url地址</td>
<td></td>
</tr>
<tr>
<td>video</td>
<td>Video</td>
<td>短视频（3.6新增）</td>
<td></td>
</tr>
<tr>
<td>skuBarCode</td>
<td>String</td>
<td>条形码</td>
<td></td>
</tr>
<tr>
<td>sellingPoints</td>
<td><code>List&lt;StyleText&gt;</code></td>
<td>商品卖点</td>
<td></td>
</tr>
<tr>
<td>sellUnit</td>
<td>StyleText</td>
<td>售卖单位</td>
<td></td>
</tr>
<tr>
<td>散装属性</td>
<td>loose</td>
<td>Boolean</td>
<td>是否散装</td>
</tr>
<tr>
<td>buyStep</td>
<td>String</td>
<td>购买步长</td>
<td></td>
</tr>
<tr>
<td>buyUnit</td>
<td>String</td>
<td>购买单位</td>
<td></td>
</tr>
<tr>
<td>商品价格</td>
<td>sellPrice</td>
<td>StyleText</td>
<td>商品售卖价（原价或促销价），单位元，带符号¥</td>
</tr>
<tr>
<td>dashPrice</td>
<td>StyleText</td>
<td>商品划线价（原价），单位元，带符号¥</td>
<td></td>
</tr>
<tr>
<td>memberPrice</td>
<td>StyleText</td>
<td>商品会员价，单位元，带符号¥</td>
<td></td>
</tr>
<tr>
<td>specPrice</td>
<td>StyleText</td>
<td>商品折合价，单位元，带符号¥</td>
<td></td>
</tr>
<tr>
<td>seqPrice</td>
<td>Long</td>
<td>商品价格，单位分</td>
<td></td>
</tr>
<tr>
<td>商品销量</td>
<td>dailySales</td>
<td>Long</td>
<td>日售量</td>
</tr>
<tr>
<td>offlineMonthSales</td>
<td>StyleText</td>
<td>线下月销量（目前只有堂食在使用该字段，走的是线下月销量）</td>
<td></td>
</tr>
<tr>
<td>商品标签</td>
<td>tags</td>
<td><code>List&lt;TagStyleText&gt;</code></td>
<td>v2 标签 v3 营销类标签 （type 值类型 1 业务标签 2 促销标签 3 运营标签 4 降价类标签）</td>
</tr>
<tr>
<td>limitTags</td>
<td><code>List&lt;StyleText&gt;</code></td>
<td>v3 限制说明类标签</td>
<td></td>
</tr>
<tr>
<td>titleTag</td>
<td>Image</td>
<td>商品名称前图片标签（3.5新增）</td>
<td></td>
</tr>
<tr>
<td>limitTag</td>
<td>StyleText</td>
<td>限购标签</td>
<td></td>
</tr>
<tr>
<td>titleTags</td>
<td><code>List&lt;TagEntity&gt;</code></td>
<td>全局标签优化（标题前图片标签,预留支持数组,本期只会下发一个,该字段全局标签优化使用,数组为后续扩展预留）</td>
<td></td>
</tr>
<tr>
<td>v2Tags</td>
<td><code>List&lt;TagEntity&gt;</code></td>
<td>商品全局标签组 （包含文字标签与图片标签 按照对应类型取值使用 标签内容类型 “ “ type 值类型 1 履约标签 2 促销标签 3 属性标签 4 品牌标签 5 服务标签）<strong>V550之后type值类型：</strong>1 履约标签 2 促销标签 3 属性标签 4 品牌标签 5服务标签 6售卖时间标签 7 特定运营标签 8 特定属性标签 9 温度标签 10 活动标签 11 常买标签 12 运营标签 13 基础属性标签 14 限制标签</td>
<td></td>
</tr>
<tr>
<td>stockTag</td>
<td>StyleText</td>
<td>最后N件标签</td>
<td></td>
</tr>
<tr>
<td>priceTag</td>
<td>StyleText</td>
<td>价格标签（如：晚市价）</td>
<td></td>
</tr>
<tr>
<td>sellPoint</td>
<td>StyleText</td>
<td>卖点标签</td>
<td></td>
</tr>
<tr>
<td>saleTag</td>
<td>StyleText</td>
<td>降价标签</td>
<td></td>
</tr>
<tr>
<td>top</td>
<td>StyleText</td>
<td>top标签</td>
<td></td>
</tr>
<tr>
<td>moduleTag</td>
<td>StyleText</td>
<td>模块特色标签文案（目前下发菜场爆品专区销量文案：已抢xx份）</td>
<td></td>
</tr>
<tr>
<td>推荐信息</td>
<td>recReason</td>
<td>RecReasonVO</td>
<td>推荐理由</td>
</tr>
<tr>
<td>boardChosenReasons</td>
<td><code>List&lt;StyleText&gt;</code></td>
<td>入榜理由（只有榜单落地页使用）</td>
<td></td>
</tr>
<tr>
<td>购买信息</td>
<td>buyPv</td>
<td>StyleText</td>
<td>买过N次</td>
</tr>
<tr>
<td>pv</td>
<td>String</td>
<td>买过N次</td>
<td></td>
</tr>
<tr>
<td>uv</td>
<td>String</td>
<td>购买人数</td>
<td></td>
</tr>
<tr>
<td>buyUv</td>
<td>StyleText</td>
<td>购买人数</td>
<td></td>
</tr>
<tr>
<td>lastBuyPriceTextPrefix</td>
<td>StyleText</td>
<td>上次购买XX元文案 prefix</td>
<td></td>
</tr>
<tr>
<td>lastBuyPriceText</td>
<td>StyleText</td>
<td>上次购买XX元文案</td>
<td></td>
</tr>
<tr>
<td>lastBuyPriceTextSuffix</td>
<td>StyleText</td>
<td>上次购买XX元文案 suffix</td>
<td></td>
</tr>
<tr>
<td>订阅提醒</td>
<td>subStatus</td>
<td>Boolean</td>
<td>是否已订阅（3.8新增 ）</td>
</tr>
<tr>
<td>subscription</td>
<td>Boolean</td>
<td>订阅提醒模式（3.8新增）</td>
<td></td>
</tr>
<tr>
<td>加工服务</td>
<td>process</td>
<td>Boolean</td>
<td>是否存在加工服务</td>
</tr>
<tr>
<td>serviceName</td>
<td>String</td>
<td>规格服务名称</td>
<td></td>
</tr>
<tr>
<td>processVO</td>
<td>ProcessVO</td>
<td>加工服务的内容</td>
<td></td>
</tr>
<tr>
<td>按钮</td>
<td>sellButton</td>
<td>Button</td>
<td>加车文案，是否可点击</td>
</tr>
<tr>
<td>buttonList</td>
<td><code>List&lt;Button&gt;</code></td>
<td>button列表</td>
<td></td>
</tr>
<tr>
<td>其他</td>
<td>soldOutUrl</td>
<td>String</td>
<td>抢光图片</td>
</tr>
<tr>
<td>globalImg</td>
<td>Image</td>
<td>商品活动图片（例如：年货节）</td>
<td></td>
</tr>
<tr>
<td>similar</td>
<td>Boolean</td>
<td>是否是查看相似（3.16版本新增）</td>
<td></td>
</tr>
<tr>
<td>skuSellType</td>
<td>SkuSellType</td>
<td><em>内部计算使用，不返给客户端</em></td>
<td></td>
</tr>
<tr>
<td>choiceEnable</td>
<td>Boolean</td>
<td>是否唤起规格浮层（多规格商品 或 存在加工服务）</td>
<td></td>
</tr>
</tbody></table>
<p><strong>SkuListVO</strong></p>
<p>结合SkuPagedListVO、SkuSearchPagedListVO、SkuV2PagedListVO几个vo。</p>
<p>当前searchVO有部分属性，如quickSearchWords、searchFoldStrategy ，是在controller或者facade中根据大搜的召回结果进一步计算赋值。</p>
<p>SkuListVO计划不包含这类属性，capi层可以扩展实现子类，自行处理一些零散特殊的属性逻辑。</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>itemList</td>
<td><code>List&lt;SkuVO&gt;</code></td>
<td>vo列表</td>
</tr>
<tr>
<td>ffset</td>
<td>Integer</td>
<td>请求偏移量</td>
</tr>
<tr>
<td>limit</td>
<td>Integer</td>
<td>请求数量</td>
</tr>
<tr>
<td>total</td>
<td>Integer</td>
<td>数据总数</td>
</tr>
<tr>
<td>moduleTitle</td>
<td>String</td>
<td>模块标题</td>
</tr>
<tr>
<td>strategy</td>
<td>String</td>
<td>ab策略</td>
</tr>
<tr>
<td>styleMap</td>
<td>Map</td>
<td>样式map</td>
</tr>
<tr>
<td>styleStrategy</td>
<td>String</td>
<td>样式策略</td>
</tr>
<tr>
<td>popularRecommendScene</td>
<td>Integer</td>
<td>场景值</td>
</tr>
<tr>
<td>recommondList</td>
<td>List</td>
<td>推荐列表</td>
</tr>
</tbody></table>
<p><strong>流量放大</strong></p>
<p>问题：</p>
<p>list服务中按skuIds请求了商品，在调用其他下游服务时，某些下游服务仍会继续请求一遍相同的商品信息，造成流量放大。</p>
<p>思路：</p>
<p>找到一种方式，能将本次请求已获得的商品信息，传给下游。</p>
<p>将当前完全并行的服务调用，修改为两步：先请求商品和其他不会造成流量放大的服务，再请求剩余服务。在请求中传入商品信息。</p>
<p><strong>商品信息传递的方式：</strong></p>
<p>可以通过”<strong>消息上下文</strong>“传递给下游。下游判断，如果上下文中能获取到商品信息，则不调用商品服务。</p>
<p>具体实现：将对象序列化成string，放到rpc的header中，由rpc框架内部处理。</p>
<p>问题：</p>
<p>1）会造成list服务调用下游的整体耗时增长一倍左右。</p>
<p>2）需要下游做定制处理。</p>
<p>暂定在本次系统实现中不处理这个问题。</p>
<p><strong>业务架构</strong></p>
<p>“商品统一展示”是从当前capi中剥离出来，会涉及到对上下多个服务改造，这里有必要对整体的架构分层和职责边界做一个讨论约定。</p>
<p><img src="/images/745.png" alt="图片14"></p>
<p>每层详细说明</p>
<table>
<thead>
<tr>
<th>分层</th>
<th>定位</th>
<th>系统</th>
<th>领域对象</th>
<th>业务功能</th>
<th>职责边界说明</th>
</tr>
</thead>
<tbody><tr>
<td>网关层</td>
<td>无业务功能，面向技术域</td>
<td>shepherd api</td>
<td>协议安全流量</td>
<td>协议转换：http与rpc协议，报文转换安全防控：认证、鉴权流量管理：限流、熔断、降级</td>
<td>shepherd api本身提供了服务编排能力，但从解耦的角度出发，不应该在该层做编排，这是属于业务领域的事情。</td>
</tr>
<tr>
<td>业务接口层</td>
<td>面向用户操作的复杂业务流程</td>
<td>展销capi</td>
<td>商品菜谱品类资源位榜单门店</td>
<td>来源过滤：客户端、场景、渠道版本控制：abtest策略过滤：显示过滤（有无图片）排序干预显示：样式、提示</td>
<td>一个view（url接口）可能需要多种业务领域实体，对每个业务领域实体，都只需要调用一次后端服务就能获取到所需要的数据，不需要多次调用各种细粒度数据再来组装。符合的有：品类、资源位、标签、菜谱不符合的有：商品</td>
</tr>
<tr>
<td>促销capi</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>聚合服务层</td>
<td>由多个相近领域的服务组合而成，可降低业务接口层的复杂度</td>
<td>商品列表服务</td>
<td>商品展示模型商品标准模型</td>
<td>组装商品展示模型：将各类零散数据聚合成商品展示模型，包括一些样式、提示等根据场景和上下文，组装完整的商品列表</td>
<td>聚合了上层所需要的商品列表数据模型，上层不需要再去额外获取</td>
</tr>
<tr>
<td>基础服务层</td>
<td>独立的原子业务领域，不同场景下可灵活组合不同基础服务</td>
<td>poi、product、price、stock、poicatecquery</td>
<td>大部分都是原子业务领域有一个cquery是聚合领域，把商品部分信息聚合到一个服务中</td>
<td>维护本领域内部实体的增删改查</td>
<td>每个服务都是原子业务，从业务上不可再拆分，相互之间独立解耦，不依赖于其他服务。由上层服务在流程中组装使用。</td>
</tr>
</tbody></table>
<p><strong>数据模型</strong></p>
<p>整体的数据模型如下：</p>
<img src="/images/746.png" alt="图片15" style="zoom:50%;" />

<p><strong>概要设计</strong></p>
<p>功能模型</p>
<p><img src="/images/747.png" alt="图片16"></p>
<p>1.管理业务配置信息及场景规则策略等；</p>
<p>2.系统通过定时任务将配置信息加载到内存；</p>
<p>3.各个商品列表入口调用列表服务；列表服务根据场景获取配置信息，根据配置信息编排流程；对请求商品进行聚合（调用下游获取业务信息），过滤，渲染，截取，排序等；</p>
<p>4.将处理好的数据返回给调用入口；</p>
<p><strong>交互模型</strong></p>
<p><img src="/images/748.png" alt="图片17"></p>
<p><strong>详细设计</strong></p>
<p><strong>总体结构</strong></p>
<p><img src="/images/749.png" alt="图片18"></p>
<p><img src="/images/750.png" alt="图片19"></p>
<p>接口和功能：</p>
<table>
<thead>
<tr>
<th>接口</th>
<th>功能</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>querySkuList</td>
<td>查询商品列表</td>
<td>输入skuIdList 和 需要查询的属性信息</td>
</tr>
<tr>
<td>querySkuDetail</td>
<td>查询商品详情</td>
<td>输入skuId 和 需要查询的属性信息</td>
</tr>
</tbody></table>
<p><strong>现状梳理</strong></p>
<table>
<thead>
<tr>
<th>系统</th>
<th>商品数据模型</th>
<th>商品列表</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>展销capi</td>
<td>SkuListItemVO、SkuV2ListItemVO、SkuDetail4VOSkuDetailComboDTO、PoiSkuDetailDTO</td>
<td>SkuPagedListVOSkuPagedListDTO</td>
<td></td>
</tr>
<tr>
<td>促销capi</td>
<td>SkuListItemVO</td>
<td></td>
<td>是展销capi的子集</td>
</tr>
<tr>
<td>交易capi</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>结论：</p>
<ul>
<li><p>当前展销capi和促销capi在获取商品列表时，使用的数据模型可以统一。</p>
</li>
<li><p>当前各数据模型中，除了纯粹的商品属性，还包含了文案、样式、提示语、图片样式等前端展示相关的信息。</p>
</li>
</ul>
<p><strong>功能模块</strong></p>
<p><strong>配置模块</strong></p>
<p><img src="/images/751.png" alt="图片20"></p>
<img src="/images/752.png" alt="图片21" style="zoom:50%;" />



<p>配置预加载流程图</p>
<p><img src="/images/753.png" alt="图片22"></p>
<p>1.系统初始化的时候会读取策略规则信息和配置信息到内存map中；</p>
<p>2.每分钟定时任务会读取数据库更新内存map中的策略规则信息和配置信息；</p>
<p><strong>配置表</strong></p>
<p>场景表</p>
<pre><code class="sql">CREATE TABLE `af_list_scene` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;自增主键&#39;,
  `name` varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;名称&#39;,
  `code` varchar(100) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;场景编码&#39;,
  `description` varchar(500) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;描述&#39;,
  `status` int(11) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;状态：0待生效，10在线，20手动下线&#39;,
  `operator` varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;操作人&#39;,
  `ctime` bigint(20) NOT NULL COMMENT &#39;创建时间&#39;,
  `utime` bigint(20) NOT NULL COMMENT &#39;修改时间&#39;,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uniq_code` (`code`)
) ENGINE=InnoDB AUTO_INCREMENT=36 DEFAULT CHARSET=utf8mb4 COMMENT=&#39;场景表&#39;

CREATE TABLE `af_list_scene_config` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;自增主键&#39;,
  `name` varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;名称&#39;,
  `description` varchar(500) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;描述&#39;,
  `status` int(11) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;状态：0待生效，10在线，20手动下线&#39;,
  `config` json DEFAULT NULL COMMENT &#39;场景配置json&#39;,
  `parent_id` bigint(20) unsigned NOT NULL COMMENT &#39;场景配置的父id&#39;,
  `operator` varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;操作人&#39;,
  `ctime` bigint(20) NOT NULL COMMENT &#39;创建时间&#39;,
  `utime` bigint(20) NOT NULL COMMENT &#39;修改时间&#39;,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=118 DEFAULT CHARSET=utf8mb4 COMMENT=&#39;场景配置表&#39;

CREATE TABLE `af_list_scene_strategy` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;自增主键&#39;,
  `name` varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;名称&#39;,
  `description` varchar(500) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;描述&#39;,
  `status` int(11) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;状态：0待生效，10在线，20手动下线&#39;,
  `rule` json DEFAULT NULL COMMENT &#39;场景策略json&#39;,
  `scene_id` bigint(20) unsigned NOT NULL COMMENT &#39;场景id&#39;,
  `scene_config_id` bigint(20) unsigned NOT NULL COMMENT &#39;场景配置id&#39;,
  `operator` varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;操作人&#39;,
  `ctime` bigint(20) NOT NULL COMMENT &#39;创建时间&#39;,
  `utime` bigint(20) NOT NULL COMMENT &#39;修改时间&#39;,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1034 DEFAULT CHARSET=utf8mb4 COMMENT=&#39;场景策略表&#39;
</code></pre>
<pre><code class="json">&#123;
    &quot;name&quot;:&quot;SkuListScene&quot;,
    &quot;type&quot;:&quot;SkuListSceneConfig&quot;,
    &quot;subConfigList&quot;:[
        &#123;
            &quot;name&quot;:&quot;SkuFilter&quot;,
            &quot;type&quot;:&quot;SkuFilterStageConfig&quot;,
            &quot;subConfigList&quot;:[
                &#123;
                    &quot;name&quot;:&quot;Filter&quot;,
                    &quot;rule&quot;:&#123;
                        &quot;showFixedSell&quot;:true,
                        &quot;showNotSellState&quot;:false,
                        &quot;showNotInSellTime&quot;:false,
                        &quot;showNotEnoughStock&quot;:false
                    &#125;,
                    &quot;type&quot;:&quot;DefaultFilterConfig&quot;
                &#125;
            ]
        &#125;,
        &#123;
            &quot;name&quot;:&quot;SkuTruncate&quot;,
            &quot;type&quot;:&quot;SkuTruncateStageConfig&quot;,
            &quot;subConfigList&quot;:[
                &#123;
                    &quot;name&quot;:&quot;CommonTruncate&quot;,
                    &quot;rule&quot;:&#123;
                        &quot;maxLimit&quot;:&quot;10&quot;,
                        &quot;minLimit&quot;:&quot;6&quot;
                    &#125;,
                    &quot;type&quot;:&quot;CommonTruncateConfig&quot;
                &#125;
            ]
        &#125;,
        &#123;
            &quot;name&quot;:&quot;SkuRender&quot;,
            &quot;type&quot;:&quot;SkuRenderStageConfig&quot;,
            &quot;subConfigList&quot;:[
                &#123;
                    &quot;name&quot;:&quot;ImageRender&quot;,
                    &quot;type&quot;:&quot;ImageRenderConfig&quot;
                &#125;,
                &#123;
                    &quot;name&quot;:&quot;TitleRender&quot;,
                    &quot;type&quot;:&quot;TitleRender4UpV507Config&quot;
                &#125;,
                &#123;
                    &quot;name&quot;:&quot;PriceRender&quot;,
                    &quot;type&quot;:&quot;PriceRenderConfig&quot;
                &#125;,
                &#123;
                    &quot;name&quot;:&quot;TagRender&quot;,
                    &quot;rule&quot;:&#123;
                        &quot;productTag&quot;:true,
                        &quot;businessTag&quot;:true,
                        &quot;promotionTag&quot;:true
                    &#125;,
                    &quot;type&quot;:&quot;TagRenderConfig4CategoryChannel&quot;
                &#125;,
                &#123;
                    &quot;name&quot;:&quot;ButtonRender&quot;,
                    &quot;type&quot;:&quot;ButtonRenderConfig&quot;
                &#125;,
                &#123;
                    &quot;name&quot;:&quot;SalesRender&quot;,
                    &quot;rule&quot;:&#123;
                        &quot;totalOrderNum7Day&quot;:true
                    &#125;,
                    &quot;type&quot;:&quot;SalesRenderConfig&quot;
                &#125;
            ]
        &#125;
    ]
&#125;
</code></pre>
<p>执行模块流程图</p>
<p><img src="/images/754.png" alt="图片23"></p>
<p><strong>执行过程主流程</strong></p>
<p><img src="/images/755.png" alt="图片24"></p>
<p>各业务能力抽象流程图</p>
<p><img src="/images/756.png" alt="图片25"></p>
<p><strong>过滤能力池</strong></p>
<table>
<thead>
<tr>
<th>过滤任务</th>
<th>前置校验</th>
<th>构造参数</th>
<th>校验规则</th>
</tr>
</thead>
<tbody><tr>
<td>CouponFilterTaskExecutor</td>
<td>通用</td>
<td>获取优惠券过滤规则</td>
<td>通过规则判断是否进行可用券过滤；</td>
</tr>
<tr>
<td>DefaultFilterTaskExecutor</td>
<td>通用</td>
<td>所有的产品列表</td>
<td>过滤电子卡过滤天天果园-黑名单券包PoiSkuSaleStatus堂食过滤商品状态，valid， 不过滤可售卖时间根据条件选择过滤售卖状态过滤不在售卖时间抢光过滤定期售过滤</td>
</tr>
<tr>
<td>IdFilterTaskExecutor</td>
<td>通用+检查是否命中渠道</td>
<td>从数据库配置中获取需要过滤的id列表</td>
<td>id在该列表中则过滤</td>
</tr>
<tr>
<td>MemberPriceFilterTaskExecutor</td>
<td>通用</td>
<td>null</td>
<td>如果配置了展示会员价，判断是否可展示会员价 * 条件：1、会员价大于0；2、无促销价&amp;&amp;会员价&lt;原价 或 有促销价&amp;&amp;会员价&lt;促销价不满足条件则过滤</td>
</tr>
<tr>
<td>PriceFilterTaskExecutor</td>
<td>通用</td>
<td>从请求参数中获取价格比较规则</td>
<td>判断产品售价是否在区间范围内</td>
</tr>
</tbody></table>
<p><strong>3）排序能力池</strong></p>
<table>
<thead>
<tr>
<th>排序任务</th>
<th>排序规则</th>
</tr>
</thead>
<tbody><tr>
<td>PriceSortTaskExecutor</td>
<td>默认缺货的要置底可以根据售卖价格升序或降序</td>
</tr>
<tr>
<td>SellGroupSortTaskExecutor</td>
<td><em>可加车商品放到最前面</em></td>
</tr>
<tr>
<td>StockSortTaskExecutor</td>
<td><em>商品库存: 取商品基础库存和活动库存两者的最小值*<em>商品库存升序或降序</em></em></td>
</tr>
</tbody></table>
<p><strong>4）截取能力池</strong></p>
<table>
<thead>
<tr>
<th>截取任务</th>
<th>截取规则</th>
</tr>
</thead>
<tbody><tr>
<td>CarouselTruncateTaskExecutor</td>
<td>如果小于最小值则返回空；如果大于最小值，按最大值进行截取；窃取的同时判断大于售卖个数的商品是否可售；没太看懂这是啥意思</td>
</tr>
<tr>
<td>CommonTruncateTaskExecutor</td>
<td>如果小于最小值则返回空；如果大于最小值，按最大值进行截取；</td>
</tr>
<tr>
<td>PositionTruncateTaskExecutor</td>
<td><em>截取最小值到最大值之间的产品</em></td>
</tr>
</tbody></table>
<p><strong>5）渲染能力池</strong></p>
<table>
<thead>
<tr>
<th>渲染器类</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ButtonRender</td>
<td><em>按钮（buttonList、sellButton）</em></td>
</tr>
<tr>
<td>CategoryRender</td>
<td><em>分类相关渲染执行器-后台四级类目</em></td>
</tr>
<tr>
<td>CommonRender</td>
<td><em>通用（skuBarCode、choiceEnable、[isWeakDemandSku]、similar）</em></td>
</tr>
<tr>
<td>ImageRender</td>
<td><em>图片（gifPicUrl、picUrl、titleTag、soldOutUrl）</em></td>
</tr>
<tr>
<td>ModuleTitleRender</td>
<td>moduleTitle</td>
</tr>
<tr>
<td>MoreUrlRender</td>
<td>跳转链接</td>
</tr>
<tr>
<td>PriceRender</td>
<td><em>价格（seqPrice、sellPrice、memberPrice、specPrice、dashPrice）</em></td>
</tr>
<tr>
<td>ProcessRender</td>
<td><em>加工服务（process、serviceName、processVO） serviceName、processVO 只在商详页中</em></td>
</tr>
<tr>
<td>RecReasonRender</td>
<td><em>关联理由（relateReason）*<em>推荐理由（recReason）</em></em></td>
</tr>
<tr>
<td>SalesRender</td>
<td><em>销量渲染执行器*<em>销量（dailySales、offlineMonthSales） * offlineMonthSales线下月销量，目前只有堂食业务在使用，本次不使用该属性</em></em></td>
</tr>
<tr>
<td>SellingPointsRender</td>
<td>*卖点（sellingPoints） * 根据SkuPagedListDTO中的setSellingPointsStrategy(“a”) 来判断是否设置卖点信息 * CategorySkuListFacade、SearchSkuListFacade、SkuInfoController **</td>
</tr>
<tr>
<td>SellUnitRender</td>
<td><em>销售单位文案渲染执行器</em></td>
</tr>
<tr>
<td>SubScriptionRender</td>
<td><em>订阅渲染执行器 * 要保证先走订阅，再走button</em></td>
</tr>
<tr>
<td>TagRender</td>
<td><em>标签服务执行器 * 先走price，再走tag</em>*<strong>标签（v2Tags、titleTags、globalImg、[limitTags、tags、limitTag]） * limitTags、tags、limitTag 没有使用，直接去掉*</strong> *SkuCTagUtil.<em>getSkuTag</em></td>
</tr>
<tr>
<td>TagRender4CategoryChannel</td>
<td><em>标签服务执行器 新的标签逻辑</em>SkuCTagUtil.<em>getSkuTag4V520</em></td>
</tr>
<tr>
<td>TipBarRender</td>
<td></td>
</tr>
<tr>
<td>TitleRender</td>
<td><em>标题渲染执行器  标题（skuSubTitle、skuTitle）</em></td>
</tr>
<tr>
<td>TitleRender4CategoryChannel</td>
<td></td>
</tr>
<tr>
<td>TitleRender4UpV507</td>
<td><em>标题渲染执行器V507</em></td>
</tr>
<tr>
<td>VideoRender</td>
<td><em>视频（video）</em></td>
</tr>
</tbody></table>
<p><strong>数据模型</strong></p>
<p><strong>现状梳理</strong></p>
<table>
<thead>
<tr>
<th>系统</th>
<th>商品数据模型</th>
<th>商品列表</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>展销capi</td>
<td>SkuListItemVO、SkuV2ListItemVO、SkuDetail4VOSkuDetailComboDTO、PoiSkuDetailDTO</td>
<td>SkuPagedListVOSkuPagedListDTO</td>
<td></td>
</tr>
<tr>
<td>促销capi</td>
<td>SkuListItemVO</td>
<td></td>
<td>是展销capi的子集</td>
</tr>
<tr>
<td>交易capi</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>结论：</p>
<ul>
<li><p>当前展销capi和促销capi在获取商品列表时，使用的数据模型可以统一。</p>
</li>
<li><p>当前各数据模型中，除了纯粹的商品属性，还包含了文案、样式、提示语、图片样式等前端展示相关的信息。</p>
</li>
</ul>
<p><strong>模型定义</strong></p>
<p>目前商品属性比较多，约50多个，如果将所有属性全部打平存在一个对象中，不利于理解维护。</p>
<p>另外，如果要使用缓存，最好能按照上游不同的请求参数来获取不同的缓存属性，而不是直接存取一个巨大的对象，需要考虑控制商品缓存对象的粒度。</p>
<p>因此，数据模型在实现时可以分为两层，第一层定义了完整的商品属性集合，第二层是按领域划分的不同类别的属性。</p>
<p>每个属性的类型都与前端解耦，不涉及到文案、样式、按钮等展示信息，如价格相关的都是定义为long型，由capi根据需要拼装成带符号的展示价格。</p>
<table>
<thead>
<tr>
<th>一级</th>
<th>二级</th>
<th>属性</th>
<th>类型</th>
<th>来源或计算方式</th>
</tr>
</thead>
<tbody><tr>
<td>统一商品</td>
<td>基础</td>
<td>skuId</td>
<td>long</td>
<td></td>
</tr>
<tr>
<td>skuName</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>subTitle</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>……….</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>价格</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>库存</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>预售</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>门店</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>销量</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>标签</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>推荐理由</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>订阅提醒</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>加工</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>榜单</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>分类</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>菜谱</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>……</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>在客户端请求时。</p>
<p>在缓存管理时，可以按skuId+类别进行构建，减小对象粒度。</p>
<p><strong>扩展性考虑</strong></p>
<p>在数据模型扩展时，需要考虑对 数据库表、缓存、接口对象的影响，系统如何最小成本的支持（不修改或者尽量少修改）。</p>
<p>目前本服务的数据是聚合下游多个服务产生，自身没有数据库表，所以不用考虑数据库表的影响，直接在对象上增加分类或者属性即可。</p>
<p><strong>业务流程</strong></p>
<p><strong>现状梳理</strong></p>
<p>总结出有哪些业务流程和系统调用方式，异同点。</p>
<p><img src="/images/757.png" alt="图片26"></p>
<p>初步结论：</p>
<ul>
<li><p>每个列表页的业务流程逻辑大体相似，可以抽象为10余个固化的操作阶段。</p>
</li>
<li><p>功能相似度比较高的操作是调用底层服务查询相关的逻辑。虽然各个模块的具体写法、超时、熔断降级等方式各不相同，但其业务功能是一致的，比较方便统一。</p>
</li>
<li><p>过滤、排序、干预、渲染等阶段的操作在各场景（展销-猜喜、展销-品类下的sku列表、营销-秒杀、营销-魔方）下业务实现不同，可以进行抽象，抽取出一定的规则，并通过扩展点进行能力扩展。</p>
</li>
<li><p>获取skuIds的操作从实现上可以封装到统一逻辑中，但是从业务上更贴近上层场景，可以放到上层服务中实现。</p>
</li>
</ul>
<p><strong>功能实现分析</strong></p>
<p><strong>目标</strong></p>
<p>建立一套统一的列表功能，最大化复用公共逻辑，对有差异逻辑可以方便地进行扩展。</p>
<p>可以分两步来分析：</p>
<p>1）抽象出业务流程模型和扩展模型</p>
<p>2）识别出导致差异的业务要素，选择合适的扩展实现方案</p>
<p><strong>方案</strong></p>
<p><strong>业务流程和扩展点</strong></p>
<p>通用的业务流程模型和扩展方案：</p>
<p><img src="/images/758.png" alt="图片27"></p>
<p>列表业务的流程和扩展点：</p>
<p><img src="/images/759.png" alt="图片28"></p>
<p><strong>差异要素和扩展方案</strong></p>
<p>导致列表逻辑差异的业务要素分为三类：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>取值</th>
<th>扩展实现方式</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>业务类型</td>
<td>展销业务、营销业务、交易业务</td>
<td>关联不同的子类。</td>
<td></td>
</tr>
<tr>
<td>业务模块</td>
<td>猜喜列表、分类下的sku列表、秒杀列表、魔方列表。。。。</td>
<td>关联不同的<strong>配置信息</strong>，其中定义业务规则或者具体实现</td>
<td>如果一个模块中有多个列表逻辑，可以分别设置不同的模块取值</td>
</tr>
<tr>
<td>用户请求上下文</td>
<td>app版本、ab策略、入口</td>
<td>在代码或者脚本中使用上下文，根据上下文变量开发不同逻辑</td>
<td></td>
</tr>
</tbody></table>
<p>需要注意的是，不同stage由于自身业务逻辑不同，其业务规则的抽象能力是不同的，也会影响实现方式。</p>
<p>比如排序stage可以抽象出groupby、orderby、sort、limit等规则要素，不同业务模块可以定义不同的取值实现逻辑复用。</p>
<p>但渲染stage可能就无法抽象出类似的规则，需要自定义函数实现。</p>
<p><strong>聚合数据的方案分析</strong></p>
<p>因为列表服务自身不产生数据，全部数据都是来源于基础层的各个服务，如何有效的组织多个服务调用并确保性能是一个较关键问题。</p>
<p><strong>功能分析：</strong></p>
<p>1）不同场景下调用的后端服务会有差别，需要根据输入信息对调用服务集合进行裁剪。</p>
<p>2）绝大部分服务都可以并行调用，少数场景中 部分服务之间有前后依赖？</p>
<p><strong>方案选型：</strong></p>
<table>
<thead>
<tr>
<th>方案</th>
<th>说明</th>
<th>选型</th>
<th>实现方式</th>
<th>优点</th>
<th>缺点</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>硬编码</td>
<td>在程序中编写所有服务的调用代码，对每个服务的返回结果做数据处理。</td>
<td>future</td>
<td>根据查询need参数，进行if else判断，组装AsyncFuture列表发起调用，并获得响应结果将每个响应结果的字段复制到DTO中</td>
<td>实现方案比较成熟，容易理解维护</td>
<td>代码量相对会大一些</td>
<td></td>
</tr>
<tr>
<td>rxjava</td>
<td>根据查询need参数，进行if else判断，组装Observable的操作列表发起调用，并获得响应结果将每个响应结果的字段复制到DTO中</td>
<td>性能</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>协程</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>服务编排中间件</td>
<td>如公司内部的 海盗 、外部的 <a target="_blank" rel="noopener" href="https://camel.apache.org/">Apache Camel</a>，通过配置化的方式组装服务调用和入参出参。</td>
<td>海盗</td>
<td>根据查询need参数，组装dsl和入参调用编排引擎获取结果（各字段已经按需映射到结果集中）</td>
<td>代码量相对小些？</td>
<td>新组件可能有坑</td>
<td><a target="_blank" rel="noopener" href="https://km.sankuai.com/page/358548601"> </a></td>
</tr>
</tbody></table>
<p><strong>其他</strong></p>
<p><strong>1 按需获取数据。</strong></p>
<p>按不同场景拆分，调用不同的后端服务，每个服务可以通过接口参数对需要的属性做进一步细粒度的控制，避免无脑获取全量数据。</p>
<p><strong>2 是否需要增加缓存？？</strong></p>
<p>由于没有数据变更刷新缓存的机制，使用 squirrel 会带来有数据不更新的问题。</p>
<p>可以考虑设计一种本地缓存机制，在确保有效性的情况下减少重复的服务调用，起到加速的作用。</p>
<p>为了确保线上稳定性，整个改造可以从影响面较小的服务&#x2F;场景开始，逐步迁移接入到所有服务和场景。</p>
<table>
<thead>
<tr>
<th>顺序</th>
<th>系统</th>
<th>接口</th>
<th>接口调用量</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>展销capi</td>
<td>个人中心的常买清单展销capi-购物车推荐根据订单id查询订单下的商品列表常买列表下的猜喜…….</td>
<td>日调用量在1万之下的接口</td>
</tr>
<tr>
<td></td>
<td>促销</td>
<td>秒杀落地页（SecKillingDetailController.getSeckillingPage）</td>
<td>日调用量10w级</td>
</tr>
<tr>
<td></td>
<td>展销capi</td>
<td>xxxx</td>
<td>日调用量在1万-100万的接口</td>
</tr>
<tr>
<td></td>
<td>促销capi</td>
<td>魔方列表（CubeController.getCubeProductInfo）</td>
<td>日调用量2百万（2073109）</td>
</tr>
<tr>
<td></td>
<td>展销capi</td>
<td>猜你喜欢xxxx</td>
<td>日调用量在100万之上的接口</td>
</tr>
</tbody></table>
<p><strong>管理后台</strong></p>
<p><strong>背景</strong></p>
<p>计划建立一套商品列表服务，统一管理所有场景下的商品列表逻辑。具备良好的业务抽象和扩展能力，尽量通过配置化方式实现业务功能。</p>
<p>商品列表服务的配置结构是比较复杂的，需要通过后台界面来操作，才能保证正确性。并且在后台界面中，可以方便清晰的查询理解各场景的列表业务逻辑。</p>
<p>因此，需要建立一个商品列表管理后台。</p>
<p><strong>场景管理</strong></p>
<p>功能:</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>作用</th>
<th>功能细节</th>
<th>接口</th>
</tr>
</thead>
<tbody><tr>
<td>检索</td>
<td>按条件检索场景</td>
<td>可筛选的条件:场景名称</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;search</td>
</tr>
<tr>
<td>列表</td>
<td>列出所有场景</td>
<td>可分页</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;list</td>
</tr>
<tr>
<td>新建</td>
<td>新增一个场景</td>
<td>新增时须填写&gt;场景code（必填）&gt;场景名称（必填）</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;create</td>
</tr>
<tr>
<td>编辑</td>
<td>修改场景名称</td>
<td>不能修改场景code</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;modify</td>
</tr>
</tbody></table>
<p>页面</p>
<p><img src="/images/760.png" alt="图片29"></p>
<p><img src="/images/761.png" alt="图片30"></p>
<p><strong>场景策略管理</strong></p>
<p>功能</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>作用</th>
<th>功能细节</th>
<th>接口</th>
</tr>
</thead>
<tbody><tr>
<td>检索</td>
<td>按条件检索场景策略</td>
<td>可筛选规则关联场景场景策略名称</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;search</td>
</tr>
<tr>
<td>列表</td>
<td>列出所有场景策略</td>
<td>分页</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;list</td>
</tr>
<tr>
<td>查看场景</td>
<td>查看一个具体的场景策略</td>
<td>不能修改</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;view</td>
</tr>
<tr>
<td>新建</td>
<td>新增一个场景策略</td>
<td>选定场景后，才能新增场景策略新增时须填写&gt;场景（必填）&gt;场景名称（必填）&gt;开始版本（必填）&gt;结束版本（必填）&gt;ab策略（可选）&gt;场景配置（必填）</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;create</td>
</tr>
<tr>
<td>编辑</td>
<td>修改已有的场景策略</td>
<td>除场景外的所有信息都可修改</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;modify</td>
</tr>
</tbody></table>
<p><strong>页面</strong></p>
<p><img src="/images/762.png" alt="图片31"></p>
<p><strong>场景配置管理</strong></p>
<p>功能</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>作用</th>
<th>功能细节</th>
<th>接口</th>
</tr>
</thead>
<tbody><tr>
<td>检索</td>
<td>按条件检索场景配置</td>
<td>可筛选规则场景配置名称</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenesConfig&#x2F;search</td>
</tr>
<tr>
<td>列表</td>
<td>列出所有场景配置</td>
<td>分页</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenesConfig&#x2F;list</td>
</tr>
<tr>
<td>新建</td>
<td>新增一个场景配置</td>
<td>分为基本属性、聚合、填充、过滤、排序、渲染等几块，每块里面有不同的配置内容，具体见页面效果图</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;create</td>
</tr>
<tr>
<td>编辑</td>
<td>修改已有的场景配置</td>
<td>除id外的所有信息都可修改</td>
<td>&#x2F;exhibition&#x2F;skulist&#x2F;scenes&#x2F;save</td>
</tr>
</tbody></table>
<p>页面</p>
<p><img src="/images/763.png" alt="图片32"></p>
<p><img src="/images/764.png" alt="图片33"></p>
<p><img src="/images/765.png" alt="图片34"></p>
<p><img src="/images/766.png" alt="图片35"></p>
<p><img src="/images/779.png" alt="图片36"></p>
<p><img src="/images/780.png" alt="图片37"></p>

	</div>
	<!--打赏-->
        <div class="reward">
       <div class="reward-button">赏 <span class="reward-code">
        <span class="alipay-code"> <img class="alipay-img wdp-appear" src="/alipay.png"><b>支付宝打赏</b> </span> 
        <span class="wechat-code"> <img class="wechat-img wdp-appear" src="/weipay.jpeg"><b>微信打赏</b> </span> 
       </div>
      <p class="reward-notice">如果文章对你有帮助，欢迎点击上方按钮打赏作者！</p>
      </div>
      <!--打赏-->
</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2024/05/21/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E5%95%86%E5%93%81%E7%B3%BB%E7%BB%9F/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  商品系统
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E5%BA%93%E5%AD%98%E7%B3%BB%E7%BB%9F/">
                库存系统
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>






<script>

    //document.oncontextmenu=new Function("event.returnValue=false");
	//document.onselectstart=new Function("event.returnValue=false");

	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?7eeb54583579fabc0878be210d6ad60a";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();

	

	$(function () {
		const btw = new BTWPlugin();
	    btw.init({
	        id: 'container',
	        blogId: '22377-1713171226726-221',
	        name: '月伴飞鱼',
	        qrcode: '/小程序码.jpg',
	        keyword: '验证码',
	        btnText: '为防止机器刷接口，需要完成人机检测',
        	cookieAge: 1
	    });

	    var contents = document.getElementsByClassName("content999");
	    //监听文章内容的copy事件
	    contents[0].addEventListener('copy',function(e){
	        setClipboardText(e);
	    });

	    function setClipboardText(event){
	        // clipboardData 对象是为通过编辑菜单、快捷菜单和快捷键执行的编辑操作所保留的，也就是你复制或者剪切内容
	        let clipboardData = event.clipboardData || window.clipboardData;

	        // 如果未复制或者未剪切，则return出去
	        if (!clipboardData) { return; }

	        event.preventDefault();

	        // Selection 对象，表示用户选择的文本范围或光标的当前位置。
	        // 声明一个变量接收 -- 用户输入的剪切或者复制的文本转化为字符串
	        let text = window.getSelection().toString();
	    
	        if (text) {
	            // 如果文本存在则先取消文本默认事件
	            event.preventDefault();
	            // 通过调用常clipboardData对象的 setData(format, data) 方法；来设置相关文本
	            // format: 一个DOMString 表示要添加到 drag object的拖动数据的类型。
	            // data: 一个 DOMString表示要添加到 drag object的数据。
	            var copyright = '\n\n'
	            + '\n著作权归作者所有。'
	            + '\n商业转载请联系作者获得授权，非商业转载请注明出处。'
	            + '\n作者: 月伴飞鱼'
	            + '\n原文地址: http://hardyfish.top/2024/05/20/%E4%B8%AA%E4%BA%BA%E7%9B%B8%E5%85%B3/%E5%88%97%E8%A1%A8%E7%B3%BB%E7%BB%9F/'
	    
	            clipboardData.setData('text/plain', text + copyright);
	    
	        }
	    };
	});

	
</script>

<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'container',
        blogId: '22377-1713171226726-221',
        name: '月伴飞鱼',
        qrcode: '/小程序码.jpg',
        keyword: '验证码',
        btnText: '为防止机器刷接口，需要完成人机检测',
        cookieAge: 1
    });

	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?7eeb54583579fabc0878be210d6ad60a";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">月伴飞鱼</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			PV 180986
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			UV 10079
		</span>
	
	<br>
	微信搜索 <a href="https://xiaoflyfish.oss-cn-beijing.aliyuncs.com/image/个人公众号.jpg" target="_blank">月伴飞鱼</a> 关注我
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>